对extract_evlgz_sql2.py进行增加功能

1、根据提取内容element_xml_content中查找GZDATE,GZCPDM字段。
2、提取GZDATE,GZCPDM参数信息：
    提取逻辑为字段做为参数时参数的信息，包括字段本身，关系符号，对应的值。
    例如 1.GZDATE = ？ 2.GZDATE = #{date} 3. GZDATE between ? and ? 
         4.GZCPDM = ? 5.GZCPDM in ('111','222') 6. GZCPDM in (select code from xxx)
         7. GZCPDM = xdcode
3、需要考虑字符串拼接，换行等各种情况。
4、将提取的内容放入对应的 GZDATE参数,GZCPDM参数列中
5、以下是给出的一些实际案例

"    public List<BondInfo> getBondJQJQ(String kmType, String bondType, Date monDate, String prdCode, String subjectType, Date chDate)
            throws Exception {
        List<BondInfo> bondInfos = new ArrayList<>();
        StringBuilder sql = new StringBuilder();
        sql.append(""with GZZQ as ( select KMMKET GZMKET,GZZQDM, nvl(SUM(GZSZZE),0) GZSZZE  from TGCORE.EVLGZ,TGCORE.MONKM "" +
                ""where GZCPDM= ? and GZDATE= ?  and GZKMDM=KMCODE  and KMCPLX= ?  and ISFINAL='Y' and KMZQLX in('ZQ','ZCZQ') and KMZQLS <> 'FZ'  "");
        if (""QJ"".equals(kmType)) {
            // 全价
            sql.append("" and KMTYPE in ("" + ZQ_KM_TYPE_QJ + "") "");
        } else {
            // 净价
            sql.append("" and KMTYPE in ("" + ZQ_KM_TYPE_JJ + "") "");
        }
        sql.append("" GROUP BY GZZQDM,kmmket)"");
        sql.append("" select GZZQDM,GZMKET,NVL(ZQXZJQ,0) ZQXZJQ,ZQSYQX,GZSZZE,ZQNAME,ZQZQLB from GZZQ "");
        sql.append("" inner join TGCORE.MONZQ on GZMKET=ZQMKET and GZZQDM=ZQCODE and ZQDATE=? and ZQSYFW='P' and ZQSTAT='A'"");
        if (!StringUtils.isEmpty(bondType)) {
            sql.append("" and ZQZQLB in ("").append(bondType).append("")"");
        }

        Object[] args = {prdCode, monDate, subjectType, chDate};
        try {
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            bondInfos = jdbcTemplate.queryForList(sql.toString(), args, new RowMapper<BondInfo>() {
                @Override
                public BondInfo mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondInfo bond = new BondInfo();
                    //债券代码
                    bond.setZqcode(rs.getString(""GZZQDM"").trim());
                    //债券市场
                    bond.setZqmket(rs.getString(""GZMKET"").trim());
                    //债券名称
                    bond.setZqname(rs.getString(""ZQNAME"").trim());
                    //债券类别
                    bond.setZqlb(rs.getString(""ZQZQLB"").trim());
                    //修正久期
                    bond.setZqxzjq(rs.getBigDecimal(""ZQXZJQ""));
                    //债券市值，临时存放到票面金额中
                    bond.setZqpmje(rs.getBigDecimal(""GZSZZE""));
                    //债券剩余期限
                    bond.setZqsyqx(rs.getInt(""ZQSYQX""));
                    return bond;
                }
            });
        } catch (Exception e) {
            throw new Exception(""计算债券加权久期失败"");
        }
        return bondInfos;
    }"
"    public List<BondInfo> getBondAmountAndLimit(String kmType, Date monDate, String prdCode, String subjectType, boolean existPenetrate)
            throws Exception {
        List<BondInfo> bondInfos;
        StringBuilder sql = new StringBuilder();
        sql.append(""with GZZQ as ( select KMMKET GZMKET,GZZQDM, nvl(SUM(GZSZZE),0) GZSZZE  from "");
        if (existPenetrate) {
            sql.append(ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", monDate) + "", "");
        } else {
            sql.append(""TGCORE.EVLGZ, "");
        }
        sql.append(
                ""TGCORE.MONKM where GZCPDM= ? and GZDATE= ?  and GZKMDM=KMCODE  and KMCPLX= ?  and ISFINAL='Y' and KMZQLX in('ZQ','ZCZQ') and KMZQLS <> 'FZ'  "");
        if (""QJ"".equals(kmType)) {
            // 全价
            sql.append("" and KMTYPE in ("" + ZQ_KM_TYPE_QJ + "") "");
        } else {
            // 净价
            sql.append("" and KMTYPE in ("" + ZQ_KM_TYPE_JJ + "") "");
        }
        sql.append("" GROUP BY GZZQDM,kmmket)"");
        sql.append("" select GZZQDM,GZMKET,XJLCSYQX AS ZQSYQX,ZQSYCX,ZQNAME,GZSZZE from GZZQ "");
        sql.append("" inner join TGCORE.MONZQ on GZMKET=ZQMKET and GZZQDM=ZQCODE and ZQDATE=? and ZQSYFW='P' and ZQSTAT='A'"");

        Object[] args = {prdCode, monDate, subjectType, monDate};
        try {
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            bondInfos = jdbcTemplate.queryForList(sql.toString(), args, (rs, rowNum) -> {
                BondInfo bond = new BondInfo();
                //债券代码
                bond.setZqcode(rs.getString(""GZZQDM"").trim());
                //债券市场
                bond.setZqmket(rs.getString(""GZMKET"").trim());
                //债券市值，临时存放到票面金额中
                bond.setZqpmje(rs.getBigDecimal(""GZSZZE""));
                //债券剩余期限
                bond.setZqsyqx(rs.getInt(""ZQSYQX""));
                //债券剩余存续期
                bond.setZqsycx(rs.getInt(""ZQSYCX""));
                //债券名称
                bond.setZqname(rs.getString(""ZQNAME""));
                //日期
                bond.setZqdate(monDate);
                return bond;
            });
        } catch (Exception e) {
            throw new Exception(""查询债券持仓信息失败"");
        }
        return bondInfos;
    }"
"    public List<Map<String, Object>> getHoldNumList(String prdCode, Date busDate, String subjectPrdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        sbSql.append(""WITH fz as("");
        sbSql.append(""SELECT ZQCPDM,BDZQDM,SUM( ZQDCSL )AS FZSL,BDZQMC FROM TGCORE.EVLZQDC e WHERE STRDAT <= ? and ENDDAT > ? "" +
                ""AND ZQCPDM = ? AND JYDIRT ='D' AND ZQSTAT='A' GROUP BY BDZQDM,ZQCPDM,BDZQMC ),"");
        sbSql.append("" fm as( "");
        sbSql.append(
                ""SELECT KMMKET AS GZMKET,GZZQDM,GZDATE,sum(GZGZSL) AS FMSL FROM TGCORE.MONKM m ,TGCORE.EVLGZ e WHERE GZCPDM= ? AND GZDATE= ? and KMCPLX=?  AND KMCODE =GZKMDM ""
                        +
                        ""AND KMZQLX in('ZQ','ZCZQ') AND KMTYPE ='CB' AND ISFINAL ='Y' AND KMZQLS <>'FZ' AND KMMKET='Y' GROUP BY GZCPDM,KMMKET,GZDATE,GZZQDM) "");
        sbSql.append(
                "" SELECT ZQCPDM ,BDZQDM ,nvl(FZSL,0) as FZSL ,GZZQDM,GZDATE,NVL( FMSL,0) as FMSL ,NVL(GZMKET,'Y')AS GZMKET,NVL(BDZQMC,' ') as BDZQMC  FROM fz LEFT JOIN fm ON FZ.BDZQDM=FM.GZZQDM"");

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), busDate, busDate, prdCode, prdCode, busDate, subjectPrdType);
        } catch (Exception e) {
            throw new MonitorSystException(""获取借贷数量、持仓数量失败"", e);
        }
    }"
"    public List<Map<String, Object>> getHoldNumListFromHsDb(String prdCode, Date busDate, String subjectPrdType)
            throws MonitorBussException, MonitorSystException {
        //访问备库查询分子
        StringBuilder sbSql = new StringBuilder();
        sbSql.append("" WITH fz as("");
        sbSql.append("" SELECT ZQCPDM,BDZQDM,SUM( ZQDCSL )AS FZSL,BDZQMC FROM TGCORE.EVLZQDC e ""
                + "" WHERE STRDAT <= ? and ENDDAT > ? AND ZQCPDM = ? AND JYDIRT ='D' AND ZQSTAT='A' ""
                + "" GROUP BY BDZQDM,ZQCPDM,BDZQMC )"");
        sbSql.append("" SELECT ZQCPDM ,BDZQDM ,nvl(FZSL,0) as FZSL ,NVL(BDZQMC,' ') as BDZQMC FROM fz "");
        Object[] fzargs = {busDate, busDate, prdCode};
        List<Map<String, Object>> fzList;
        try {
            final HsDbHandler hsDbHandler = SpringContextUtil.getBean(HsDbHandler.class);
            fzList = hsDbHandler.queryForList(sbSql.toString(), fzargs);
        } catch (Exception e) {
            throw new MonitorSystException(""获取借贷数量失败"", e);
        }

        //访问主库查询分母
        sbSql.setLength(0);
        sbSql.append("" WITH fm as( "");
        sbSql.append("" SELECT KMMKET AS GZMKET,GZZQDM,GZDATE,sum(GZGZSL) AS FMSL FROM TGCORE.MONKM m ,TGCORE.EVLGZ e ""
                + "" WHERE GZCPDM= ? AND GZDATE= ? and KMCPLX=?  AND KMCODE =GZKMDM ""
                + "" AND KMZQLX in('ZQ','ZCZQ') AND KMTYPE ='CB' AND ISFINAL ='Y' AND KMZQLS <>'FZ' AND KMMKET='Y' ""
                + "" GROUP BY GZCPDM,KMMKET,GZDATE,GZZQDM) "");
        sbSql.append("" SELECT GZZQDM,GZDATE,NVL( FMSL,0) as FMSL ,NVL(GZMKET,'Y')AS GZMKET FROM fm "");
        Object[] fmargs = {prdCode, busDate, subjectPrdType};
        List<Map<String, Object>> fmList;
        try {
            JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
            fmList = jdbc.queryForList(sbSql.toString(), fmargs);
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓数量失败"", e);
        }
        final Map<String, List<Map<String, Object>>> fmMap =
                fmList.stream().collect(Collectors.groupingBy(fm -> Objects.isNull(fm.get(""GZZQDM"")) ? """" : (String)fm.get(""GZZQDM"")));

        //LEFT JOIN处理
        for (Map<String, Object> fz : fzList) {
            String bdzqdm = (String)fz.get(""BDZQDM"");
            if (fmMap.containsKey(bdzqdm)) {
                final List<Map<String, Object>> subFmList = fmMap.get(bdzqdm);
                if (!CollectionUtils.isEmpty(subFmList)) {
                    final Map<String, Object> fm = subFmList.get(0);
                    fz.put(""GZZQDM"", fm.get(""GZZQDM""));
                    fz.put(""GZDATE"", fm.get(""GZDATE""));
                    fz.put(""FMSL"", fm.get(""FMSL""));
                    fz.put(""GZMKET"", fm.get(""GZMKET""));
                }
            } else {
                fz.put(""GZZQDM"", null);
                fz.put(""GZDATE"", null);
                fz.put(""FMSL"", BigDecimal.ZERO);
                fz.put(""GZMKET"", ""Y"");
            }
        }
        return fzList;
    }"
"    public List<BondGlfEntity> getHoldBonds(Date busDate, String prdCode, String subjectPrdType, String prdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        Object[] params;
        if (ZbConstants.CPLX_BX.equals(prdType) || ZbConstants.CPLX_QD.equals(prdType)) {
            sbSql.append(""with gz as ( "");
            sbSql.append(""select BIZDATE GZDATE, PRDCODE GZCPDM, KMMKET GZMKET, SECCODE GZZQDM, SUM(STADCOST) GZCBZE, SUM(STADVAL) GZSZZE "");
            sbSql.append(""from tgcore.evaluation,tgcore.monkm "");
            sbSql.append(""where BIZDATE=? and PRDCODE=? and kmcplx=? and coacode=kmcode "");
            sbSql.append(""AND KMZQLX = 'ZQ' and kmtype in('CB','YZ','JZZB01','JZZB02','JZZB03') and ISFINAL='Y' and KMZQLS <> 'FZ' "");
            sbSql.append(""GROUP BY BIZDATE, PRDCODE, KMMKET, SECCODE), "");
            sbSql.append(ZQ_QD_JW);
            sbSql.append(""jnZqResult AS ( "");
            sbSql.append(""select gz.GZMKET || ':' || gz.GZZQDM AS ZQKEY, gz.*, NVL(ZQNAME,' ') AS ZQNAME, NVL(ZQFXRN,' ') AS ZQFXRN "");
            sbSql.append(""FROM gz "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = ? and zqmket = GZMKET and zqcode = GZZQDM  "");
            sbSql.append(""WHERE zqstat = 'A' and ZQSYFW='P' AND ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','ZCZQ')  "");
            sbSql.append("") "");
            sbSql.append(""SELECT * FROM jwzqResult UNION SELECT * FROM jnZqResult "");
            params = new Object[]{busDate, prdCode, subjectPrdType, busDate, busDate, busDate, busDate};
        } else {
            sbSql.append(""WITH cczq as( "");
            sbSql.append(""select GZDATE, GZCPDM, KMMKET AS GZMKET, GZZQDM, SUM(GZCBZE) AS GZCBZE, SUM(GZSZZE) AS GZSZZE "");
            sbSql.append(""from TGCORE.EVLGZ,TGCORE.MONKM "");
            sbSql.append(""where GZDATE=? and GZCPDM=? and KMCPLX=? and KMCODE=GZKMDM "");
            sbSql.append(""and KMZQLX = 'ZQ' and KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') and ISFINAL='Y' and KMZQLS <> 'FZ' "");
            sbSql.append(""GROUP BY GZDATE, GZCPDM, KMMKET, GZZQDM) "");
            sbSql.append(""select cczq.GZMKET || ':' || cczq.GZZQDM AS ZQKEY, cczq.*, NVL(ZQNAME,' ') ZQNAME,NVL(ZQFXRN,' ') ZQFXRN FROM cczq "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = GZDATE and zqmket = GZMKET and zqcode = GZZQDM "");
            sbSql.append(""WHERE zqstat = 'A' and ZQSYFW='P' AND ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','ZCZQ') "");
            params = new Object[]{busDate, prdCode, subjectPrdType};
        }
        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), params, new RowMapper<BondGlfEntity>() {
                @Override
                public BondGlfEntity mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondGlfEntity res = new BondGlfEntity();
                    res.setZqKey(rs.getString(""ZQKEY""));
                    res.setGzDate(rs.getDate(""GZDATE""));
                    res.setGzCpdm(rs.getString(""GZCPDM""));
                    res.setGzMket(rs.getString(""GZMKET""));
                    res.setGzZqdm(rs.getString(""GZZQDM""));
                    res.setGzCbze(rs.getBigDecimal(""GZCBZE""));
                    res.setGzSzze(rs.getBigDecimal(""GZSZZE""));
                    res.setZqName(rs.getString(""ZQNAME""));
                    res.setZqFxrn(rs.getString(""ZQFXRN""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓债券失败"", e);
        }
    }"
"    public List<BondGlfEntity> getHoldBondsGlf(Date busDate, String prdCode, String subjectPrdType, String prdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        Object[] params;
        if (ZbConstants.CPLX_BX.equals(prdType) || ZbConstants.CPLX_QD.equals(prdType)) {
            sbSql.append(""WITH gz as( "");
            sbSql.append(""SELECT BIZDATE GZDATE, PRDCODE GZCPDM, KMMKET GZMKET, SECCODE GZZQDM, SUM(STADCOST) GZCBZE, SUM(STADVAL) GZSZZE "");
            sbSql.append(""from TGCORE.EVALUATION ,TGCORE.MONKM "");
            sbSql.append(""where BIZDATE=? and PRDCODE=? and KMCPLX=? and KMCODE=COACODE "");
            sbSql.append(""and KMZQLX = 'ZQ' and KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') and ISFINAL='Y' and KMZQLS <> 'FZ' "");
            sbSql.append(""GROUP BY BIZDATE, PRDCODE, KMMKET, SECCODE ),"");
            sbSql.append(ZQ_QD_JW);
            sbSql.append(""jnZqResult AS ( "");
            sbSql.append(""select gz.GZMKET || ':' || gz.GZZQDM AS ZQKEY, gz.*, NVL(ZQNAME,' ') AS ZQNAME, NVL(ZQFXRN,' ') AS ZQFXRN "");
            sbSql.append(""FROM gz "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = ? and zqmket = GZMKET and zqcode = GZZQDM  "");
            sbSql.append(""WHERE zqstat = 'A' and ZQSYFW='P' AND ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','ZCZQ')  "");
            sbSql.append(""), "");
            sbSql.append(""cczqResult AS (SELECT * FROM jwzqResult UNION SELECT * FROM jnZqResult)"");
            sbSql.append(""SELECT cczqResult.*,NVL(RELATED_PARTY_NAME,' ') AS GLFRN FROM cczqResult "");
            sbSql.append(""LEFT JOIN TGCORE.MON_RELATED_PARTY ON BUSDATE = gzdate AND ZQFXRN = ISSUER_FULLNAME "");
            sbSql.append(""ORDER BY GZZQDM,GZMKET "");
            params = new Object[]{busDate, prdCode, subjectPrdType, busDate, busDate, busDate, busDate};
        } else {
            sbSql.append(""WITH cczq as( "");
            sbSql.append(""SELECT GZDATE, GZCPDM, KMMKET AS GZMKET, GZZQDM, SUM(GZCBZE) AS GZCBZE, SUM(GZSZZE) AS GZSZZE "");
            sbSql.append(""from TGCORE.EVLGZ,TGCORE.MONKM "");
            sbSql.append(""where GZDATE=? and GZCPDM=? and KMCPLX=? and KMCODE=GZKMDM "");
            sbSql.append(""and KMZQLX = 'ZQ' and KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') and ISFINAL='Y'  and KMZQLS <> 'FZ' "");
            sbSql.append(""GROUP BY GZDATE, GZCPDM, KMMKET, GZZQDM ), "");
            sbSql.append(""cczqResult AS ( "");
            sbSql.append(""SELECT cczq.GZMKET || ':' || cczq.GZZQDM AS ZQKEY, cczq.*, NVL(ZQNAME,' ') ZQNAME, NVL(ZQFXRN,' ') ZQFXRN FROM cczq "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = GZDATE and zqmket = GZMKET and zqcode = GZZQDM  "");
            sbSql.append(""where zqstat = 'A' and ZQSYFW='P' AND ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','ZCZQ') ) "");
            sbSql.append(""SELECT cczqResult.*,NVL(RELATED_PARTY_NAME,' ') AS GLFRN FROM cczqResult "");
            sbSql.append(""LEFT JOIN TGCORE.MON_RELATED_PARTY ON BUSDATE = gzdate AND ZQFXRN = ISSUER_FULLNAME "");
            sbSql.append(""ORDER BY GZZQDM,GZMKET "");
            params = new Object[]{busDate, prdCode, subjectPrdType};
        }
        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), params, new RowMapper<BondGlfEntity>() {
                @Override
                public BondGlfEntity mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondGlfEntity res = new BondGlfEntity();
                    res.setZqKey(rs.getString(""ZQKEY""));
                    res.setGzDate(rs.getDate(""GZDATE""));
                    res.setGzCpdm(rs.getString(""GZCPDM""));
                    res.setGzMket(rs.getString(""GZMKET""));
                    res.setGzZqdm(rs.getString(""GZZQDM""));
                    res.setGzCbze(rs.getBigDecimal(""GZCBZE""));
                    res.setGzSzze(rs.getBigDecimal(""GZSZZE""));
                    res.setZqFxrn(rs.getString(""ZQFXRN""));
                    res.setZqGlf(rs.getString(""GLFRN""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓债券对应的关联方失败"", e);
        }
    }"
"    getHoldBondsGlfDetail(Date busDate, String prdCode, String subjectPrdType, String zqFxrn, String prdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        Object[] params;
        if (ZbConstants.CPLX_BX.equals(prdType) || ZbConstants.CPLX_QD.equals(prdType)) {
            sbSql.append(""WITH gz as( "");
            sbSql.append(""SELECT BIZDATE AS GZDATE,PRDCODE AS GZCPDM, "");
            sbSql.append(""ACCCODE AS GZZHDM,COACODE AS GZKMDM,KMMKET AS GZMKET, SECCODE AS GZZQDM,STADCOST AS GZCBZE,STADVAL AS GZSZZE "");
            sbSql.append(""from TGCORE.EVALUATION ,TGCORE.MONKM "");
            sbSql.append(""where BIZDATE=? and PRDCODE=? and KMCPLX=? and KMCODE=COACODE "");
            sbSql.append(""and KMZQLX = 'ZQ' and KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') and ISFINAL='Y' and KMZQLS <> 'FZ' "");
            sbSql.append(""),"");
            sbSql.append(ZQ_QD_JW);
            sbSql.append(""jnZqResult AS ( "");
            sbSql.append(""select gz.GZMKET || ':' || gz.GZZQDM AS ZQKEY, gz.*, NVL(ZQNAME,' ') AS ZQNAME, NVL(ZQFXRN,' ') AS ZQFXRN "");
            sbSql.append(""FROM gz "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = ? and zqmket = GZMKET and zqcode = GZZQDM  "");
            sbSql.append(""WHERE zqstat = 'A' and ZQSYFW='P' AND ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','ZCZQ')  "");
            sbSql.append(""), "");
            sbSql.append(""cczqResult AS (SELECT * FROM jwzqResult UNION SELECT * FROM jnZqResult) "");
            sbSql.append(""select * from cczqResult where 1 = 1 "");
            if (StringUtil.isNotEmpty(zqFxrn)) {
                sbSql.append(""AND ZQFXRN in('"" + zqFxrn + ""') "");
            }
            sbSql.append(""ORDER BY GZZQDM,GZMKET "");
            params = new Object[]{busDate, prdCode, subjectPrdType, busDate, busDate, busDate, busDate};
        } else {
            sbSql.append(""WITH cczq as( "");
            sbSql.append(""SELECT GZDATE, GZCPDM, GZZHDM, GZKMDM, KMMKET AS GZMKET, GZZQDM,GZCBZE, GZSZZE from TGCORE.EVLGZ,TGCORE.MONKM "");
            sbSql.append(""where GZDATE=? and GZCPDM=? and KMCPLX=? and KMCODE=GZKMDM "");
            sbSql.append(""and KMZQLX = 'ZQ' and KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') and ISFINAL='Y'  and KMZQLS <> 'FZ' "");
            sbSql.append(""), "");
            sbSql.append(""cczqResult AS ( "");
            sbSql.append(""SELECT cczq.GZMKET || ':' || cczq.GZZQDM AS ZQKEY, cczq.*, NVL(ZQNAME,' ') ZQNAME, NVL(ZQFXRN,' ') ZQFXRN FROM cczq "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = GZDATE and zqmket = GZMKET and zqcode = GZZQDM "");
            sbSql.append(""where zqstat = 'A' and ZQSYFW='P' AND ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','ZCZQ') "");
            if (StringUtil.isNotEmpty(zqFxrn)) {
                sbSql.append(""AND ZQFXRN in('"" + zqFxrn + ""') "");
            }
            sbSql.append("") "");
            sbSql.append(""SELECT cczqResult.* FROM cczqResult "");
            sbSql.append(""ORDER BY GZZQDM,GZMKET "");
            params = new Object[]{busDate, prdCode, subjectPrdType};
        }
        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), params, new RowMapper<BondGlfDetail>() {
                @Override
                public BondGlfDetail mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondGlfDetail res = new BondGlfDetail();
                    res.setGzZhdm(rs.getString(""GZZHDM""));
                    res.setGzKmdm(rs.getString(""GZKMDM""));
                    res.setGzMket(rs.getString(""GZMKET""));
                    res.setGzZqdm(rs.getString(""GZZQDM""));
                    res.setZqName(rs.getString(""ZQNAME""));
                    res.setGzCbze(rs.getBigDecimal(""GZCBZE""));
                    res.setGzSzze(rs.getBigDecimal(""GZSZZE""));
                    res.setZqFxrn(rs.getString(""ZQFXRN""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓债券发行人及其关联方详细信息失败"", e);
        }
    }"
"    public List<BondInfo> getBondCC(Date monDate, String prdCode, String subjectType, Date chDate) throws Exception {
        List<BondInfo> bondInfos = new ArrayList<>();
        StringBuilder sql = new StringBuilder();
        sql.append(""with GZZQ as ( select KMMKET GZMKET,GZZQDM,GZZHMC, nvl(SUM(GZSZZE),0) GZSZZE  from TGCORE.EVLGZ,TGCORE.MONKM "" +
                ""where GZCPDM= ? and GZDATE= ?  and GZKMDM=KMCODE  and KMCPLX= ?  and ISFINAL='Y' and KMZQLX in('ZQ','ZCZQ') and KMZQLS <> 'FZ'  "");
        // 净价
        sql.append("" and KMTYPE in ("" + ZQ_KM_TYPE_JJ + "") "");
        sql.append("" GROUP BY GZZQDM,KMMKET,GZZHMC)"");
        sql.append("" select GZZQDM,GZZHMC,GZMKET,GZSZZE,nvl(ZQZQLB, ' ') ZQZQLB,nvl(ZQPJJB, ' ') ZQPJJB,nvl(ZQPJNZ, ' ') ZQPJNZ from GZZQ "");
        sql.append("" left join TGCORE.MONZQ on GZMKET=ZQMKET and GZZQDM=ZQCODE and ZQDATE=? and ZQSYFW='P' and ZQSTAT='A'"");

        Object[] args = {prdCode, monDate, subjectType, chDate};
        try {
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            bondInfos = jdbcTemplate.queryForList(sql.toString(), args, new RowMapper<BondInfo>() {
                @Override
                public BondInfo mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondInfo bond = new BondInfo();
                    //债券代码
                    bond.setZqcode(rs.getString(""GZZQDM"").trim());
                    // 债券名称
                    bond.setZqname(rs.getString(""GZZHMC""));
                    //债券市场
                    bond.setZqmket(rs.getString(""GZMKET"").trim());
                    //债券市值，临时存放到票面金额中
                    bond.setZqpmje(rs.getBigDecimal(""GZSZZE""));
                    // 债券类别
                    bond.setZqlb(rs.getString(""ZQZQLB""));
                    // 债券评级级别
                    bond.setZqpjjb(rs.getString(""ZQPJJB""));
                    // 债券发行主体评级（中债除外）
                    bond.setZqpjnz(rs.getString(""ZQPJNZ""));

                    return bond;
                }
            });
        } catch (Exception e) {
            throw new Exception(""查询债券持仓失败！"");
        }
        return bondInfos;
    }"
"    public List<Map<String, Object>> getBondHoldingInfo(final Date monDate, final String prdCode, final String subjectType, final boolean isFullPrice)
            throws SQLException {
        StringBuilder sql = new StringBuilder();
        //估值表债券、资产支持证券持仓
        sql.append(""with cczq as ( "");
        sql.append(""  select GZZHDM ACCOUNT, GZZQDM as SECCODE, KMMKET as MARKET, GZSZZE, KMTZFL,KMZQLX "");
        sql.append(""  from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=?  and  GZKMDM=KMCODE "");
        sql.append(""  and KMCPLX=? and KMZQLX in ('ZQ', 'ZCZQ') and "");
        if (isFullPrice) {
            sql.append("" KMTYPE in ('CB','LX','YJLX') "");
        } else {
            sql.append("" KMTYPE in ('CB') "");
        }
        sql.append("" and KMZQLS<>'FZ' and ISFINAL='Y' ),"");
        //关联账户重分类表，取出调整后的投资分类,并提出除资产支持证券外的持有到期债券
        sql.append(""cczqfl as (select SECCODE,MARKET,GZSZZE, NVL(INVEST_CLASSIFY, KMTZFL) as TZFL,KMZQLX from cczq "");
        sql.append(""  left join (select ACCOUNT_CODE, INVEST_CLASSIFY from TGCORE.MON_INVEST_RECLASSIFY where PRD_CODE=?"" +
                "" and ? between START_DATE and END_DATE "" +
                "" and STATUS='A') cfl"");
        sql.append(""  on cfl.ACCOUNT_CODE=cczq.ACCOUNT ),"");

        sql.append("" cczqhz as (select SECCODE,MARKET,TZFL,sum(GZSZZE) AMOUNT from cczqfl where KMZQLX='ZCZQ' or TZFL<>'F' ""
                + ""group by SECCODE,MARKET,TZFL), "");

        sql.append(""chzq as (select ZQCODE,ZQMKET,ZQNAME,ZQSILB,ZQYXZQ,ZQFXRN, ZQSTRD ,ZQENDD,ZQLVLX,ZQFXCS,ZQQLTK,ZQHSRQ,ZQFXFS,ZQSYQX  "")
                .append(""from TGCORE.MONZQ where ZQDATE = ? and ZQSYFW='P' and ZQSTAT='A' ),"");

        sql.append("" zzq as ( select SECCODE, MARKET, AMOUNT,TZFL,ZQNAME as SECNAME, ZQSILB, ZQYXZQ,ZQFXRN, ZQSTRD ,""
                + ""ZQENDD,ZQLVLX,ZQFXCS ,ZQQLTK,ZQHSRQ,ZQFXFS,ZQSYQX "");
        sql.append("" from cczqhz left join chzq on ZQCODE = SECCODE and ZQMKET = MARKET ) "");
        //剔除交易类政府性银行发行的二级资本债（以及次级债）
        sql.append("" select SECCODE, MARKET, SECNAME, TZFL,AMOUNT, ZQSILB as SILB, ZQSTRD ,ZQENDD,ZQLVLX ,ZQFXCS ,""
                + ""ZQQLTK,ZQHSRQ,ZQFXFS,ZQSYQX ,'债券' as SECTYPE ""
                + ""from  zzq A where not exists(select 1 from zzq B where B.TZFL='C' and (B.zqsilb in ('ZBZ','CJZ') or B.ZQYXZQ = 'Y') ""
                + ""and B.ZQFXRN in ('国家开发银行','中国进出口银行','中国农业发展银行') AND A.SECCODE=B.SECCODE AND A.MARKET=B.MARKET)"");

        Object[] args = {prdCode, monDate, subjectType, prdCode, monDate, monDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<Map<String, Object>> getBondHoldingInfo4PreMon(final java.util.Date zlDate,
                                                               final java.util.Date evlDate,
                                                               final java.util.Date chDate,
                                                               final String prdCode,
                                                               final String subjectType,
                                                               final boolean isFullPrice)
            throws SQLException {
        StringBuilder sql = new StringBuilder();
        //估值表债券、资产支持证券持仓
        sql.append(""with "");
        sql.append(""cczq as ( "");
        sql.append(""  select GZZHDM as ACCOUNT, GZZQDM as SECCODE, KMMKET as MARKET, GZSZZE, KMTZFL,KMZQLX "");
        sql.append(""  from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=?  and  GZKMDM=KMCODE "");
        sql.append(""  and KMCPLX=? and KMZQLX in ('ZQ', 'ZCZQ') and "");
        if (isFullPrice) {
            sql.append("" KMTYPE in ('CB','LX','YJLX') "");
        } else {
            sql.append("" KMTYPE in ('CB') "");
        }
        sql.append("" and KMZQLS<>'FZ' and ISFINAL='Y' "");
        sql.append("" union all"");
        //当天所有的银行间交易指令，卖债金额为负
        sql.append("" select ACCCODE as ACCOUNT, zlzqdm  as SECCODE ,'Y' as MARKET, "");
        if (isFullPrice) {
            sql.append(""(case zljylx when 'S' then -ZLQJJE else ZLQJJE end) as GZSZZE,"");
        } else {
            sql.append(""(case zljylx when 'S' then -zljjje else zljjje end) as GZSZZE,"");
        }
        sql.append("" zltzfl as KMTZFL, 'X' as KMZQLX from tgcore.MON_ZL_YHJZQZL "");
        sql.append("" where zlcpdm = ? and zldate = ?  "");
        sql.append("" union all "");
        //网下申购的 ,用的是期望日期为今天的
        sql.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL,'X' as KMZQLX from tgcore""
                + "".MON_ZL_WXXZZL where ""
                + ""zlcpdm = ? and zldate = ? "");
        sql.append("" union all "");
        //T+0的，用的是期望日期为今天的
        sql.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL,'X' as KMZQLX from tgcore""
                + "".MON_ZL_HSTLZL ""
                + ""where zlcpdm ""
                + ""= ? and zlqwrq = ? "");
        sql.append("" ),"");
        //关联账户重分类表，取出调整后的投资分类,并提出除资产支持证券外的持有到期债券
        sql.append(""cczqfl as (select SECCODE,MARKET,GZSZZE, NVL(INVEST_CLASSIFY, KMTZFL) as TZFL from cczq "");
        sql.append(""  left join (select ACCOUNT_CODE, INVEST_CLASSIFY from TGCORE.MON_INVEST_RECLASSIFY where PRD_CODE=? "" +
                "" and ? between START_DATE and END_DATE "" +
                ""and STATUS='A') cfl"");
        sql.append(""  on cfl.ACCOUNT_CODE=cczq.ACCOUNT where KMZQLX in ('ZCZQ','X') or KMTZFL<>'F'),"");
        //按证券代码、市场、投资分类汇总
        sql.append(""zqflhz as (select SECCODE,MARKET,TZFL,sum(GZSZZE) as AMOUNT from cczqfl group by SECCODE,MARKET,TZFL), "");

        sql.append(""chzq as (select ZQCODE,ZQMKET,ZQNAME,ZQSILB,ZQYXZQ,ZQFXRN,ZQSYQX,ZQSTRD,ZQENDD,ZQFXFS,ZQLVLX,ZQFXCS,ZQQLTK,ZQHSRQ "")
                .append(""from TGCORE.MONZQ where ZQDATE = ? and ZQSYFW='P' and ZQSTAT='A' ),"");

        sql.append("" zzq as ( select SECCODE, MARKET, AMOUNT,TZFL,ZQNAME as SECNAME, ZQSILB, ZQFXRN,ZQSYQX,ZQYXZQ,ZQSTRD,ZQENDD,ZQFXFS,ZQLVLX,ZQFXCS,""
                + ""ZQQLTK,ZQHSRQ "");
        sql.append("" from zqflhz left join chzq on ZQCODE = SECCODE and ZQMKET = MARKET where ZQSILB='ZCZQ' or ZQSILB is NULL or TZFL<>'F')"");
        //剔除交易类政府性银行发行的二级资本债（以及次级债）
        sql.append("" select SECCODE, MARKET, SECNAME, TZFL,AMOUNT, ZQSILB as SILB, ZQSTRD ,ZQENDD,ZQFXFS,ZQLVLX,ZQFXCS,ZQQLTK,ZQHSRQ,ZQSYQX,'债券' as ""
                + ""SECTYPE ""
                + ""from  zzq A""
                + "" where not exists(select 1 from zzq B where B.TZFL='C' and (B.zqsilb in ('ZBZ','CJZ') or B.ZQYXZQ = 'Y') and B.ZQFXRN in ""
                + ""('国家开发银行',""
                + ""'中国进出口银行','中国农业发展银行') AND A.SECCODE=B.SECCODE AND A.MARKET=B.MARKET)"");

        Object[] args = {prdCode, evlDate, subjectType,
                prdCode, zlDate,
                prdCode, zlDate,
                prdCode, zlDate,
                prdCode, evlDate,
                chDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<Map<String, Object>> getBondHoldingInfo4PreMon4Detail(final java.util.Date zlDate,
                                                               final java.util.Date evlDate,
                                                               final java.util.Date chDate,
                                                               final String prdCode,
                                                               final String subjectType,
                                                               final boolean isFullPrice)
            throws SQLException {
        StringBuilder sql = new StringBuilder();
        //估值表债券、资产支持证券持仓
        sql.append(""with "");
        sql.append(""cczq as ( "");
        sql.append(""  select GZZHDM as ACCOUNT, GZZQDM as SECCODE, KMMKET as MARKET, GZSZZE, KMTZFL,'T-1' AS SQDATAFROM,KMZQLX "");
        sql.append(""  from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=?  and  GZKMDM=KMCODE "");
        sql.append(""  and KMCPLX=? and KMZQLX in ('ZQ', 'ZCZQ') and "");
        if (isFullPrice){
            sql.append("" KMTYPE in ('CB','LX','YJLX') "");
        } else {
            sql.append("" KMTYPE in ('CB') "");
        }
        sql.append("" and KMZQLS<>'FZ' and ISFINAL='Y' "");
        sql.append("" union all"");
        //当天所有的银行间交易指令，卖债金额为负
        sql.append("" select ACCCODE as ACCOUNT, zlzqdm  as SECCODE ,'Y' as MARKET, "");
        if (isFullPrice){
            sql.append(""(case zljylx when 'S' then -ZLQJJE else ZLQJJE end) as GZSZZE,"");
        } else {
            sql.append(""(case zljylx when 'S' then -zljjje else zljjje end) as GZSZZE,"");
        }
        sql.append("" zltzfl as KMTZFL,'T' AS SQDATAFROM, 'X' as KMZQLX from tgcore.MON_ZL_YHJZQZL "");
        sql.append("" where zlcpdm = ? and zldate = ?  "");
        sql.append("" union all "");
        //网下申购的 ,用的是期望日期为今天的
        sql.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL,'T' AS SQDATAFROM,'X' as KMZQLX from tgcore""
                + "".MON_ZL_WXXZZL where ""
                + ""zlcpdm = ? and zldate = ? "");
        sql.append("" union all "");
        //T+0的，用的是期望日期为今天的
        sql.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL,'T' AS SQDATAFROM,'X' as KMZQLX from tgcore""
                + "".MON_ZL_HSTLZL ""
                + ""where zlcpdm ""
                + ""= ? and zlqwrq = ? "");
        sql.append("" ),"");
        //关联账户重分类表，取出调整后的投资分类,并提出除资产支持证券外的持有到期债券
        sql.append(""cczqfl as (select SECCODE,MARKET,GZSZZE, NVL(INVEST_CLASSIFY, KMTZFL) as TZFL,SQDATAFROM from cczq "");
        sql.append(""  left join (select ACCOUNT_CODE, INVEST_CLASSIFY from TGCORE.MON_INVEST_RECLASSIFY where PRD_CODE=? "" +
                "" and ? between START_DATE and END_DATE "" +
                ""and STATUS='A') cfl"");
        sql.append(""  on cfl.ACCOUNT_CODE=cczq.ACCOUNT where KMZQLX in ('ZCZQ','X') or KMTZFL<>'F'),"");
        //按证券代码、市场、投资分类汇总
        sql.append(""zqflhz as (select SECCODE,MARKET,TZFL,SQDATAFROM,GZSZZE as AMOUNT from cczqfl), "");

        sql.append(""chzq as (select ZQCODE,ZQMKET,ZQNAME,ZQSILB,ZQYXZQ,ZQFXRN,ZQSYQX,ZQSTRD,ZQENDD,ZQFXFS,ZQLVLX,ZQFXCS,ZQQLTK,ZQHSRQ "")
                .append(""from TGCORE.MONZQ where ZQDATE = ? and ZQSYFW='P' and ZQSTAT='A' ),"");

        sql.append("" zzq as ( select SECCODE, MARKET, AMOUNT,TZFL,SQDATAFROM,ZQNAME as SECNAME, ZQSILB, ZQFXRN,ZQSYQX,ZQYXZQ,ZQSTRD,ZQENDD,ZQFXFS,ZQLVLX,"" +
                ""ZQFXCS,""
                + ""ZQQLTK,ZQHSRQ "");
        sql.append("" from zqflhz left join chzq on ZQCODE = SECCODE and ZQMKET = MARKET where ZQSILB='ZCZQ' or ZQSILB is NULL or TZFL<>'F')"");
        //剔除交易类政府性银行发行的二级资本债（以及次级债）
        sql.append("" select SECCODE, MARKET, SECNAME, TZFL,SQDATAFROM,AMOUNT, ZQSILB as SILB, ZQSTRD ,ZQENDD,ZQFXFS,ZQLVLX,ZQFXCS,ZQQLTK,ZQHSRQ,ZQSYQX,'债券' as ""
                + ""SECTYPE ""
                + ""from  zzq A""
                + "" where not exists(select 1 from zzq B where B.TZFL='C' and (B.zqsilb in ('ZBZ','CJZ') or B.ZQYXZQ = 'Y') and B.ZQFXRN in ""
                + ""('国家开发银行',""
                + ""'中国进出口银行','中国农业发展银行') AND A.SECCODE=B.SECCODE AND A.MARKET=B.MARKET)"");

        Object[] args = {prdCode, evlDate, subjectType,
                prdCode, zlDate,
                prdCode, zlDate,
                prdCode, zlDate,
                prdCode, evlDate,
                chDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<SecurityBaseEntity> getForbiddenBondHolding(final String prdCode, final java.util.Date monDate,
                                                            final String subjectType, final String forbiddenType)
            throws SQLException {
        StringBuilder sql = new StringBuilder(128);
        sql.append(""with gz as (select GZZQDM, KMMKET from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=? and KMCPLX=?  and GZKMDM=KMCODE ""
                + ""and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ') "");
        sql.append(""select distinct GZZQDM,KMMKET, nvl(ZQNAME,' ') as ZQNAME, nvl(ZQSILB,' ') as ZQSILB from gz left join ""
                + ""(select ZQCODE,ZQMKET,ZQSILB,ZQNAME from TGCORE.MONZQ ""
                + ""where ZQDATE=? and ZQSTAT='A' and ZQSYFW='P') ""
                + ""on  ZQMKET =KMMKET and ZQCODE = GZZQDM where ZQSILB in ("").append(forbiddenType).append("") or trim(ZQSILB) is null "");
        Object[] args = new Object[]{prdCode, monDate, subjectType, monDate};

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args, new RowMapper<SecurityBaseEntity>() {
            @Override
            public SecurityBaseEntity mapRow(final ResultSet rs, final int rowNum) throws Exception {
                SecurityBaseEntity e = new SecurityBaseEntity();
                e.setSecCode(rs.getString(""GZZQDM"").trim());
                e.setSecType(rs.getString(""ZQSILB"").trim());
                e.setSecMarket(rs.getString(""KMMKET"").trim());
                e.setSecName(rs.getString(""ZQNAME"").trim());
                return e;
            }
        });
    }"
"    public List<TyglrtyzqblEntity> getHoldingBondIncludeZyq(MonObject monObject, java.util.Date monDate, boolean isShowDetail)
            throws MonitorBussException {
        //科目产品类型
        SubjectConfig subjectConfig = SpringContextUtil.getBean(SubjectConfig.class);
        String subjectType = subjectConfig.getSubjectType(monObject.getPrdEntity(), monDate);
        StringBuilder sql = new StringBuilder(512);
        sql.append(""with zq as (select ZQCODE, ZQMKET,ZQNAME, ZQCLGM,ZQZQLB from tgcore.MONZQ where ZQDATE=? and ZQSTAT='A' and ZQSYFW='P'),"");
        //本产品持仓债券
        if (ProductTypeUtil.isBXorQD(monObject.getPrdType())) {
            sql.append(
                            ""cczq as (select SECCODE as GZZQDM, KMMKET from tgcore.EVALUATION, tgcore.MONKM where PRDCODE=? and BIZDATE=? and KMCPLX=? and "")
                    .append(""COACODE=KMCODE and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ'),"");
        } else {
            sql.append(""cczq as (select GZZQDM, KMMKET from tgcore.EVLGZ, tgcore.MONKM where GZCPDM=? and GZDATE=? and KMCPLX=? and "")
                    .append(""GZKMDM=KMCODE and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ'),"");
        }


        sql.append(""cczqgm as (select GZZQDM, KMMKET, ZQNAME, ZQCLGM,ZQZQLB from cczq left join zq "")
                .append(""on ZQMKET =KMMKET and ZQCODE = GZZQDM where ZQZQLB not in ('GZ','YP','ZCJR','DFZ','KZZ','JHGS') or ZQZQLB is null),"");
        //本产品持仓质押债券
        sql.append(""zyq as (select ZYZYDM as GZZQDM,ZYMKET as KMMKET from tgcore.JYSQTQS, TGCORE.JYSNHGZY where ZYCPDM=QSCPDM and "")
                .append(""ZYDATE=QSQTRQ and ZYMKET=QSMKET and QSCJBH=ZYCJBH and ZYCRTD<? and ZYSTAT='A' "")
                .append(""and QSCPDM=? and QSMMBZ='S' AND qsstat ='A' and qsywbz = 'ZQLQ'  AND qsqtrq <= ?  AND qsqtrq + TO_NUMBER(qszqdm) > ? "")
                .append(""group by ZYZYDM, ZYMKET having sum(ZYCJSL) > 0),"");
        sql.append(""zyqgm as (select GZZQDM, KMMKET, ZQNAME, ZQCLGM,ZQZQLB from zyq, zq where ZQMKET =KMMKET and ZQCODE = GZZQDM "")
                .append(""and ZQZQLB not in ('GZ','YP','ZCJR','DFZ','KZZ','JHGS')),"");
        //本产品持仓的债券和质押券
        sql.append(""cpcc as (select GZZQDM, KMMKET, ZQNAME, ZQCLGM,ZQZQLB from cczqgm "")
                .append(""union "")
                .append(""select GZZQDM, KMMKET, ZQNAME, ZQCLGM,ZQZQLB from zyqgm),"");
        //本产品的管理人下的所有产品
        sql.append(""glrcp as (select CPCODE,CPCPLX from tgcore.MONPR, (select CPMNAM as MANAGER from tgcore.MONPR where CPCODE=?) "")
                .append(""where upper(REGEXP_REPLACE(trim(CPMNAM), '[()（）]', '')) = upper(REGEXP_REPLACE(trim(MANAGER), '[()（）]', ''))),"");
        sql.append(""glrcpkm as( select CPCODE,CPCPLX,SUBJECT_TYPE from glrcp join (select PRD_TYPE,SUBJECT_TYPE,"")
                .append(""ROW_NUMBER() over(partition by PRD_TYPE order by SEQN desc) as "")
                .append(""rn from TGCORE.MON_PROD_SUBJECT where ? between START_DATE and END_DATE) a on CPCPLX=PRD_TYPE and rn=1 ), "");
        //管理人持仓本产品持仓的债券
        sql.append(""glrcczq as (select CPCODE, GZZHDM, GZZQDM, KMMKET, GZGZSL from tgcore.EVLGZ, tgcore.MONKM, glrcpkm "")
                .append(""where GZCPDM=CPCODE and KMCPLX=SUBJECT_TYPE and "")
                .append(""GZDATE=? and GZKMDM=KMCODE and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ' "");
        sql.append("" union all "");
        sql.append(""select CPCODE, ACCCODE as GZZHDM,SECCODE as GZZQDM, KMMKET, EVLQTY as GZGZSL from TGCORE.EVALUATION, tgcore.MONKM, glrcpkm "")
                .append(""where PRDCODE=CPCODE and BIZDATE=? and COACODE=KMCODE and KMCPLX=SUBJECT_TYPE "")
                .append(""and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ' and KMKMBZ='CNY' and KMBZXX<>'OVERSEA'"");
        sql.append("" union all "");
        sql.append("" select CPCODE, '质押券' as GZZHDM,ZYZYDM as GZZQDM,ZYMKET as KMMKET, sum(ZYCJSL) as GZGZSL "")
                .append(""from tgcore.JYSQTQS, TGCORE.JYSNHGZY, glrcpkm "")
                .append(""where ZYCPDM=QSCPDM and ZYDATE=QSQTRQ and ZYMKET=QSMKET "")
                .append(""and QSCJBH=ZYCJBH and QSCPDM=CPCODE and QSMMBZ='S' AND qsstat ='A' and qsywbz = 'ZQLQ'  AND qsqtrq <= ?  AND "")
                .append("" qsqtrq + TO_NUMBER(qszqdm) > ? and ZYCRTD<? and ZYSTAT='A' group by CPCODE, ZYZYDM,ZYMKET having sum(ZYCJSL) > 0)"");

        if (isShowDetail) {
            sql.append("" select glrcczq.CPCODE, GZZHDM, glrcczq.GZZQDM, glrcczq.KMMKET, GZGZSL, ZQNAME, ZQCLGM,ZQZQLB from glrcczq, cpcc where "")
                    .append(""glrcczq.GZZQDM=cpcc.GZZQDM "")
                    .append(""and glrcczq.KMMKET=cpcc.KMMKET order by glrcczq.CPCODE, GZZHDM, glrcczq.GZZQDM"");
        } else {
            sql.append("" select glrcczq.GZZQDM, glrcczq.KMMKET, sum(GZGZSL) as GZGZSL, ZQNAME, ZQCLGM,ZQZQLB from glrcczq, cpcc "")
                    .append(""where glrcczq.GZZQDM=cpcc.GZZQDM "")
                    .append(""and glrcczq.KMMKET=cpcc.KMMKET group by glrcczq.GZZQDM, glrcczq.KMMKET, ZQNAME, ZQCLGM,ZQZQLB"");
        }


        Object[] args = new Object[]{monDate,
                monObject.getValue(), monDate, subjectType,
                monDate, monObject.getValue(), monDate, monDate,
                monObject.getValue(), monDate,
                monDate, monDate, monDate, monDate, monDate};

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbcTemplate.queryForList(sql.toString(), args, new RowMapper<TyglrtyzqblEntity>() {
                @Override
                public TyglrtyzqblEntity mapRow(final ResultSet rs, final int rowNum) throws Exception {
                    TyglrtyzqblEntity entity = new TyglrtyzqblEntity();
                    entity.setSecName(rs.getString(""ZQNAME""));
                    entity.setSecCode(rs.getString(""GZZQDM"").trim());
                    entity.setSecMarket(rs.getString(""KMMKET"").trim());
                    entity.setGzgzsl(rs.getBigDecimal(""GZGZSL""));
                    entity.setScale(rs.getBigDecimal(""ZQCLGM""));
                    entity.setBondType(rs.getString(""ZQZQLB""));
                    if (isShowDetail) {
                        entity.setAccount(rs.getString(""GZZHDM""));
                        entity.setPrdCode(rs.getString(""CPCODE""));
                    }
                    return entity;
                }
            });
        } catch (Exception e) {
            throw new MonitorBussException(""获取管理人持仓债券数据失败"", e);
        }
    }"
"    public List<BondInfo> getBondValue4Held2MaturityI9(String prdCode, Date monDate, String subjectType,
                                                       boolean isFullPrice) throws MonitorBussException, MonitorSystException {
        StringBuilder sb = new StringBuilder();
        /**
         * 获取业务日该产品的估值信息
         */
        sb.append(""with cczq as ( "");
        sb.append(""  select GZZHDM ACCOUNT, GZZQDM as SECCODE, KMMKET as MARKET, GZSZZE, KMTZFL,KMZQLX "");
        sb.append(""  from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=?  and  GZKMDM=KMCODE "");
        sb.append(""  and KMCPLX=? and KMZQLX = 'ZQ' and "");
        if (isFullPrice){
            sb.append("" KMTYPE in ('CB','LX','YJLX') "");
        } else {
            sb.append("" KMTYPE in ('CB') "");
        }
        sb.append("" and KMZQLS<>'FZ' and ISFINAL='Y' ),"");
        sb.append(""cczqfl as (select SECCODE,MARKET,GZSZZE, NVL(INVEST_CLASSIFY, KMTZFL) as TZFL,KMZQLX from cczq "");
        sb.append(""  left join (select ACCOUNT_CODE, INVEST_CLASSIFY from TGCORE.MON_INVEST_RECLASSIFY where PRD_CODE=? "" +
                "" and ? between START_DATE and END_DATE "" +
                ""and STATUS='A') cfl on cfl.ACCOUNT_CODE=cczq.ACCOUNT ),"");
        sb.append("" cczqhz as (select SECCODE,MARKET,TZFL,sum(GZSZZE) AMOUNT from cczqfl where TZFL in ('F','C') ""
                + ""group by SECCODE,MARKET,TZFL), "");
        /*
         * 获取业务日该产品的债券信息
         */
        sb.append(BOND_INFO_SQL);
        /**
         * 得到其持仓金额（市值总额）和剩余期限
         */
        sb.append(""select AMOUNT,SYQX,SECCODE,MARKET,ZQCODE,TZFL, zqsilb, ZQNAME from ("");
        sb.append(""select AMOUNT,"")
                .append(this.getRemainderDaysSql4I9(monDate))
                .append("" as SYQX,SECCODE,MARKET,NVL(ZQCODE,' ') ZQCODE,TZFL,NVL(ZQSILB,' ') as zqsilb,ZQNAME from cczqhz left ""
                        + ""join "");
        sb.append(""ZQ on MARKET=ZQMKET and SECCODE=ZQCODE and ZQDATE=? and ZQSTAT='A' "");
        sb.append(""where TZFL ='F' or ( TZFL ='C' and (zqsilb in ('CJZ','ZBZ') or zqyxzq='Y') and ZQFXRN in ""
                + ""('国家开发银行','中国进出口银行','中国农业发展银行')  ))"");

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        Object[] args = {prdCode, monDate, subjectType, prdCode, monDate, monDate, getFuzzyPrdCode(prdCode), monDate, monDate};
        try {
            return jdbcTemplate.queryForList(sb.toString(), args,
                    new RowMapper<BondInfo>() {
                        @Override
                        public BondInfo mapRow(ResultSet rs, int count)
                                throws Exception {
                            BondInfo bondInfo = new BondInfo();
                            // 为例方便处理这里把持仓金额放到发行价格里去 ,后面要用的时候注意
                            bondInfo.setZqfxjg(rs.getBigDecimal(""AMOUNT""));
                            // 为例方便处理这里把剩余期限放到存量规模里去 ,后面要用的时候注意
                            bondInfo.setZqclgm(rs.getBigDecimal(""SYQX""));
                            bondInfo.setZqcode(rs.getString(""SECCODE""));
                            bondInfo.setZqmket(rs.getString(""MARKET""));
                            bondInfo.setZqfxjc(rs.getString(""ZQNAME""));
                            // 债券名称存放用于判断债券数据是否存在的债券代码
                            bondInfo.setZqname(rs.getString(""ZQCODE""));
                            bondInfo.setZqfxzq(rs.getString(""TZFL""));
                            bondInfo.setZqsilb(rs.getString(""zqsilb""));
                            return bondInfo;
                        }
                    });
        } catch (Exception e) {
            throw new MonitorSystException(e.toString(), e);
        }
    }"
"    public List<BondInfo> getcczq4CydqI9(String prdCode, Date chDate, Date qxDate, String subjectType,
                                         boolean isFullPrice) throws MonitorBussException, MonitorSystException {
        StringBuilder sb = new StringBuilder();
        // 取上日持仓的债券
        // 持有到期1111（非资产支持证券）
        sb.append(""with "");
        sb.append(""cczq as ( "");
        sb.append(""  select GZZHDM as ACCOUNT, GZZQDM as SECCODE, KMMKET as MARKET, GZSZZE, KMTZFL "");
        sb.append(""  from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=?  and  GZKMDM=KMCODE "");
        sb.append(""  and KMCPLX=? and KMZQLX = 'ZQ' and "");
        if (isFullPrice){
            sb.append("" KMTYPE in ('CB','LX','YJLX') "");
        } else {
            sb.append("" KMTYPE in ('CB') "");
        }
        sb.append("" and KMZQLS<>'FZ' and ISFINAL='Y' "");
        sb.append("" union all"");
        //当天所有的银行间交易指令，卖债金额为负
        sb.append("" select ACCCODE as ACCOUNT, zlzqdm  as SECCODE ,'Y' as MARKET, "");
        if (isFullPrice){
            sb.append(""(case zljylx when 'S' then -ZLQJJE else ZLQJJE end) as GZSZZE,"");
        } else {
            sb.append(""(case zljylx when 'S' then -zljjje else zljjje end) as GZSZZE,"");
        }
        sb.append("" zltzfl as KMTZFL from tgcore.MON_ZL_YHJZQZL "");
        sb.append("" where zlcpdm = ? and zldate = ?  "");
        sb.append("" union all "");
        //网下申购的 ,用的是期望日期为今天的
        sb.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL "" +
                ""from tgcore.MON_ZL_WXXZZL where zlcpdm = ? and zldate = ? "");
        sb.append("" union all "");
        //T+0的，用的是期望日期为今天的
        sb.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL "" +
                ""from tgcore.MON_ZL_HSTLZL where zlcpdm = ? and zlqwrq = ? "");
        sb.append("" ),"");
        //关联账户重分类表，取出调整后的投资分类,并提出除资产支持证券外的持有到期债券
        sb.append(""cczqfl as (select SECCODE,MARKET,GZSZZE, NVL(INVEST_CLASSIFY, KMTZFL) as TZFL from cczq "");
        sb.append(""  left join (select ACCOUNT_CODE, INVEST_CLASSIFY from TGCORE.MON_INVEST_RECLASSIFY where PRD_CODE=?"" +
                "" and ? between START_DATE and END_DATE "" +
                "" and STATUS='A') cfl"");
        sb.append(""  on cfl.ACCOUNT_CODE=cczq.ACCOUNT where KMTZFL in ('F','C')),"");
        //按证券代码、市场、投资分类汇总
        sb.append(""zqflhz as (select SECCODE,MARKET,TZFL,sum(GZSZZE) as AMOUNT from cczqfl group by SECCODE,MARKET,TZFL), "");
        /**
         * 取该产品专用债券，若不存在专用债券则去取公用债券
         */
        sb.append(BOND_INFO_SQL);
        sb.append("" select SECCODE,MARKET,AMOUNT,zqstrd,zqendd,zqlvlx,zqfxcs,zqqltk,zqhsrq,zqsilb,ZQSHXQ,ZQSYFW,ZQYXZQ ""
                + ""from zqflhz left join ZQ on zqdate = ? and zqcode = SECCODE and zqmket = MARKET and zqstat='A' "" +
                "" where tzfl ='F' or ( tzfl ='C' and (zqsilb in ('CJZ','ZBZ') or zqyxzq='Y') and ZQFXRN in ('国家开发银行',""
                + ""'中国进出口银行','中国农业发展银行'))"");

        Object[] args = {prdCode, chDate, subjectType, prdCode, qxDate, prdCode, qxDate, prdCode,
                qxDate, prdCode, chDate, chDate, getFuzzyPrdCode(prdCode), chDate, chDate};
        return executeSql4Held2MaturityPreMon(sb, args);
    }"
"    public List<BondInfo> getcczq4CydqI9ForSqDetail(String prdCode, Date chDate, Date qxDate, String subjectType,
                                         boolean isFullPrice) throws MonitorBussException, MonitorSystException {
        StringBuilder sb = new StringBuilder();
        // 取上日持仓的债券
        // 持有到期1111（非资产支持证券）
        sb.append(""with "");
        sb.append(""cczq as ( "");
        sb.append(""  select GZZHDM as ACCOUNT, GZZQDM as SECCODE, KMMKET as MARKET, GZSZZE, KMTZFL,'T-1' AS SQDATAFROM "");
        sb.append(""  from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=?  and  GZKMDM=KMCODE "");
        sb.append(""  and KMCPLX=? and KMZQLX = 'ZQ' and "");
        if (isFullPrice){
            sb.append("" KMTYPE in ('CB','LX','YJLX') "");
        } else {
            sb.append("" KMTYPE in ('CB') "");
        }
        sb.append("" and KMZQLS<>'FZ' and ISFINAL='Y' "");
        sb.append("" union all"");
        //当天所有的银行间交易指令，卖债金额为负
        sb.append("" select ACCCODE as ACCOUNT, zlzqdm  as SECCODE ,'Y' as MARKET, "");
        if (isFullPrice){
            sb.append(""(case zljylx when 'S' then -ZLQJJE else ZLQJJE end) as GZSZZE,"");
        } else {
            sb.append(""(case zljylx when 'S' then -zljjje else zljjje end) as GZSZZE,"");
        }
        sb.append("" zltzfl as KMTZFL,'T' AS SQDATAFROM from tgcore.MON_ZL_YHJZQZL "");
        sb.append("" where zlcpdm = ? and zldate = ?  "");
        sb.append("" union all "");
        //网下申购的 ,用的是期望日期为今天的
        sb.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL,'T' AS SQDATAFROM "" +
                ""from tgcore.MON_ZL_WXXZZL where zlcpdm = ? and zldate = ? "");
        sb.append("" union all "");
        //T+0的，用的是期望日期为今天的
        sb.append("" select ACCCODE as ACCOUNT, zlzqdm as SECCODE,zlmket as MARKET,zljyje as GZSZZE,zltzfl as KMTZFL,'T' AS SQDATAFROM "" +
                ""from tgcore.MON_ZL_HSTLZL where zlcpdm = ? and zlqwrq = ? "");
        sb.append("" ),"");
        //关联账户重分类表，取出调整后的投资分类,并提出除资产支持证券外的持有到期债券
        sb.append(""cczqfl as (select SECCODE,MARKET,GZSZZE, NVL(INVEST_CLASSIFY, KMTZFL) as TZFL,SQDATAFROM from cczq "");
        sb.append(""  left join (select ACCOUNT_CODE, INVEST_CLASSIFY from TGCORE.MON_INVEST_RECLASSIFY where PRD_CODE=?"" +
                "" and ? between START_DATE and END_DATE "" +
                "" and STATUS='A') cfl"");
        sb.append(""  on cfl.ACCOUNT_CODE=cczq.ACCOUNT where KMTZFL in ('F','C')),"");
        //按证券代码、市场、投资分类汇总
        sb.append(""zqflhz as (select SECCODE,MARKET,TZFL,SQDATAFROM,GZSZZE as AMOUNT from cczqfl), "");
        /**
         * 取该产品专用债券，若不存在专用债券则去取公用债券
         */
        sb.append(BOND_INFO_SQL);
        sb.append("" select SECCODE,MARKET,AMOUNT,zqstrd,zqendd,zqlvlx,zqfxcs,zqqltk,zqhsrq,zqsilb,ZQSHXQ,ZQSYFW,ZQYXZQ ""
                + "",ZQNAME,TZFL,SQDATAFROM ""
                + ""from zqflhz left join ZQ on zqdate = ? and zqcode = SECCODE and zqmket = MARKET and zqstat='A' "" +
                "" where tzfl ='F' or ( tzfl ='C' and (zqsilb in ('CJZ','ZBZ') or zqyxzq='Y') and ZQFXRN in ('国家开发银行',""
                + ""'中国进出口银行','中国农业发展银行'))"");

        Object[] args = {prdCode, chDate, subjectType, prdCode, qxDate, prdCode, qxDate, prdCode,
                qxDate, prdCode, chDate, chDate, getFuzzyPrdCode(prdCode), chDate, chDate};
        return executeSql4Held2MaturityPreMonForDetail(sb, args);
    }"
"    public List<Map<String, Object>> getCurrentDepositAndPosition(final String prdCode,
                                                   final Date evlDate,
                                                   final String subjectType) throws SQLException {
        String sql = ""select GZSZZE as AMOUNT, (case KMZQLX when 'BFJ' then '备付金' else '活期存款' end) as SECTYPE, GZZHDM as SECCODE, 0 as SYQX ""
                + ""from tgcore.EVLGZ, tgcore.MONKM where GZCPDM=? and GZDATE=?  and  GZZHDM=KMCODE and KMCPLX=? and ""
                + ""((KMZQLX='CK' and KMZQLS='HQ' and ISFINAL='Y') or (KMZQLX='BFJ' and KMLEVL='1'))"";
        Object[] args = {prdCode, evlDate, subjectType};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql, args);
    }"
"    public List<Map<String, Object>> IncreaseOrReduce(String cpdm, Date date, boolean isHb, boolean isI9, String kmcplx) throws Exception {
        StringBuilder sbSql = new StringBuilder(1028);
        Date jyrdq = calendarDao.addJysDate(date, 10).getDate();
        Date yhjdq = calendarDao.addYhjDate(date, 10).getDate();
        Date lastWorkDate = CalendarUtil.lastWorkDay(date.toString());
        //T_1为上一日数据，T为业务日期数据
        //违约债券  p4上一个交易日 估值表数据 ，gz4业务日期估值表数据
        sbSql.append("" with "");
        sbSql.append(JJTZSXZC.getGpSql(""_T_1""));
        sbSql.append(JJTZSXZC.getGpSql(""_T0""));
        sbSql.append("" gp_T_1 as ("");
        sbSql.append("" select ZHDM,ZQDM,SL from fgkgp_T_1 "");
        sbSql.append("" union all select ZHDM,ZQDM,SL from tpgp_T_1 "");
        sbSql.append("" ), "");
        sbSql.append("" gp_T0 as ("");
        sbSql.append("" select ZHDM,ZQDM,SL from fgkgp_T0 "");
        sbSql.append("" union all select ZHDM,ZQDM,SL from tpgp_T0 "");
        sbSql.append("" ), "");
        sbSql.append("" gpsg_T0 as ("");
        sbSql.append("" select ZQDM,MKET,sum(SL) as SL from ( "");
        sbSql.append("" select SXZQDM as ZQDM,SXJESL as SL,SXMKET as MKET from ltsxgp_T0) group by MKET,ZQDM "");
        sbSql.append("" ), "");
        sbSql.append("" gpsg_T_1 as ( "");
        sbSql.append(
                "" select SXZQDM as ZQDM,SXMKET as MKET,sum(SXJESL) as SL from tgcore.MONLTSX where SXCPDM=? and SXZQLB='GP' and SXSTRD<=? and SXENDD>=? and SXSTAT= 'A' "");
        sbSql.append("" and exists (select 1 from gpsg_T0 where ZQDM=SXZQDM and MKET=SXMKET) group by SXZQDM,SXMKET "");
        sbSql.append("" ), "");

        sbSql.append("" pz4 as (select GZGZSL,GZZHDM,GZZQDM,GZDATE,KMMKET AS GZMKET "");
        sbSql.append("" from tgcore.evlgz,tgcore.monkm where GZDATE=? and GZCPDM=? and "");
        //sbSql.append("" GZZHDM like '1103__01_%'), "");
        sbSql.append("" (KMCODE = GZKMDM AND KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZQ' AND KMZQLS not in ('FZ','WY')) ), "");
        sbSql.append("" pzwy4 as (select GZGZSL,GZZHDM,GZZQDM,GZDATE,KMMKET AS GZMKET "");
        sbSql.append("" from tgcore.evlgz,tgcore.monkm where gzcpdm=? and gzdate=? and "");
        sbSql.append("" KMCODE = GZKMDM AND KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZQ' AND KMZQLS = 'WY' ), "");

        sbSql.append("" gz4 as (select GZGZSL,GZZHDM,GZZQDM,GZDATE,KMMKET AS GZMKET "");
        sbSql.append("" from tgcore.evlgz,tgcore.monkm where GZDATE=? and GZCPDM=? and "");
        //sbSql.append("" GZZHDM like '1103__01_%') "");
        sbSql.append("" (KMCODE = GZKMDM AND KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZQ' AND KMZQLS not in ('FZ','WY')) ), "");
        sbSql.append("" gzwy4 as (select GZGZSL,GZZHDM,GZZQDM,GZDATE,KMMKET AS GZMKET "");
        sbSql.append("" from tgcore.evlgz,tgcore.monkm where gzcpdm=? and gzdate=? and "");
        sbSql.append("" KMCODE = GZKMDM AND KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZQ' AND KMZQLS = 'WY' ) "");

        sbSql.append("" select NVL(pz5.GZGZSL,0) T_1,'WYZQ' LB,NVL(pz5.GZZQDM,gz5.GZZQDM) GZZQDM,NVL(gz5.GZGZSL,0) T  FROM "");
        sbSql.append("" (select GZZHDM,GZGZSL,GZZQDM from pz4 join tgcore.monwy on GZDATE=WYDATE and GZMKET=WYMKET and GZZQDM=WYZQDM "" +
                "" union all select GZZHDM,GZGZSL,GZZQDM from pzwy4 )pz5 "");
        sbSql.append("" full join (select GZZHDM,GZGZSL,GZZQDM from gz4 join tgcore.monwy on GZDATE=WYDATE and GZMKET=WYMKET and GZZQDM=WYZQDM "" +
                "" union all select GZZHDM,GZGZSL,GZZQDM from gzwy4 )gz5 "");
        sbSql.append("" on pz5.GZZHDM=gz5.GZZHDM "");

        //手工维护股票（按照股票代码与市场比较手维）
        sbSql.append("" union all "");
        sbSql.append("" select NVL(pz1.SL,0) T_1,'GP' LB,NVL(pz1.ZQDM,gz1.ZQDM)||'(手维)' GZZQDM,NVL(gz1.SL,0) T  from "");
        sbSql.append("" (select * from gpsg_T_1) pz1 full join (select * from gpsg_T0) gz1 on pz1.ZQDM=gz1.ZQDM and pz1.MKET=gz1.MKET "");
        //停牌股票与非公开发行股票（按照账户来比较）+转融通受限科目
        sbSql.append("" union all "");
        sbSql.append("" select NVL(pz1.SL,0) T_1,'GP' LB,NVL(pz1.ZQDM,gz1.ZQDM) GZZQDM,NVL(gz1.SL,0) T  from "");
        sbSql.append("" (select * from gp_T_1) pz1 full join (select * from gp_T0) gz1 on pz1.ZHDM=gz1.ZHDM "");

        List<Map<String, Object>> mapList = new ArrayList<>();
        Object[] paras = new Object[]{
                lastWorkDate, cpdm, lastWorkDate, kmcplx, cpdm, lastWorkDate, lastWorkDate, //上一日股票
                date, cpdm, date, kmcplx, cpdm, date, date,  //今日股票
                cpdm, lastWorkDate, lastWorkDate,
                lastWorkDate, cpdm, kmcplx, cpdm, lastWorkDate, kmcplx, date, cpdm, kmcplx, cpdm, date, kmcplx    //违规债券
        };
        mapList.addAll(queryForList(sbSql.toString(), paras));

        //交易所逆回购，回购到期，买
        sbSql.setLength(0);
        sbSql.append(
                "" select CAST(0 AS decimal) T_1,'JYSQS' LB,QSGQDM GZZQDM,CAST(count(1) AS decimal) T from tgcore.jysqs where QSCRTD=? and QSDATE>? and QSDATE>? and QSCPDM=? AND QSMMBZ='B' and QSYWBZ='FBDQ' and QSSTAT='A' group by QSGQDM,QSMKET "");
        paras = new Object[]{date, date, jyrdq, cpdm};
        mapList.addAll(queryForList(sbSql.toString(), paras));

        //银行间逆回购
        sbSql.setLength(0);
        sbSql.append(
                "" select CAST(0 AS decimal) T_1,'YHJHG' LB,HGCODE GZZQDM,CAST(count(1) AS decimal) T from tgcore.yhjhg where HGDATE=? and HGENDD>? and HGENDD>? and HGCPDM=? and HGHGFX='B' and HGSTAT='A' group by HGCODE "");
        paras = new Object[]{date, date, yhjdq, cpdm};
        mapList.addAll(queryForList(sbSql.toString(), paras));

        //交易所质押式逆回购,到期未清算，卖
        sbSql.setLength(0);
        sbSql.append(
                "" select CAST(0 AS decimal) T_1,'JYSQTQS' LB,QSGQDM GZZQDM,CAST(count(1) AS decimal) T from tgcore.JYSQTQS where QSCPDM=? and qscrtd=? and QSDATE>? and qsdate>? and QSMMBZ='S' and QSYWBZ='ZQLQ' and QSSTAT='A' group by QSGQDM,QSMKET "");
        paras = new Object[]{cpdm, date, jyrdq, date};
        mapList.addAll(queryForList(sbSql.toString(), paras));

        //定期存款
        sbSql.setLength(0);
        sbSql.append(
                "" select CAST(0 AS decimal) T_1,'EVLDQ' LB,DQCJBH GZZQDM,CAST(count(1) AS decimal) T from tgcore.evldq where DQCPDM=? and DQSTRD=? and DQENDD>? and DQENDD>? and DQSTAT='A' and DQTQTJ='Y' group by DQCJBH "");
        paras = new Object[]{cpdm, date, date, yhjdq};
        mapList.addAll(queryForList(sbSql.toString(), paras));

        //转融通
        sbSql.setLength(0);
        sbSql.append("" select CAST(0 AS decimal) T_1, 'ZRTDZ' as LB, DZHYBH GZZQDM, CAST(count(1) AS decimal) T from tgcore.zrtdz A where "");
        //取期限超过10个交易所工作日
        sbSql.append(
                "" DZCPDM=? and DZCJRQ=? and STATUS='A' and 11 <= (select count(1) FROM TGCORE.PUBRL where RLDATE between A.DZCJRQ and A.DZHYDQ and RLWORK='Y') group by DZHYBH"");
        paras = new Object[]{cpdm, date};
        mapList.addAll(queryForList(sbSql.toString(), paras));

        if (!isHb) {
            //资产支持证券
            sbSql.setLength(0);
            sbSql.append("" select NVL(pz2.GZGZSL,0) T_1,'ZC' LB,NVL(pz2.GZZQDM,gz2.GZZQDM) GZZQDM,NVL(gz2.GZGZSL,0) T from "");
            sbSql.append("" (SELECT GZZHDM,GZZQDM,GZGZSL FROM TGCORE.EVLGZ,TGCORE.MONKM WHERE GZDATE=? AND GZCPDM=? and "");
            //GZZHDM like '1104__01_%') pz2
            sbSql.append("" (KMCODE = GZKMDM AND  KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZCZQ' AND KMZQLS <> 'FZ' ) ) pz2 "");
            sbSql.append("" full join (SELECT GZZHDM,GZZQDM,GZGZSL FROM TGCORE.EVLGZ,TGCORE.MONKM WHERE GZDATE=? AND GZCPDM=? AND "");
            //sbSql.append("" GZZHDM like '1104__01_%') gz2 "");
            sbSql.append("" (KMCODE = GZKMDM AND  KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZCZQ' AND KMZQLS <> 'FZ' )) gz2 "");
            sbSql.append("" on pz2.GZZHDM=gz2.GZZHDM "");
            paras = new Object[]{lastWorkDate, cpdm, kmcplx, date, cpdm, kmcplx};
            mapList.addAll(queryForList(sbSql.toString(), paras));

        } else {
            sbSql.setLength(0);
            sbSql.append("" select NVL(pz2.GZGZSL,0) T_1,'ZC' LB,NVL(pz2.GZZQDM,gz2.GZZQDM) GZZQDM,NVL(gz2.GZGZSL,0) T from "");
            sbSql.append("" (SELECT GZZHDM,GZZQDM,GZGZSL FROM TGCORE.EVLGZ,TGCORE.MONKM WHERE GZDATE=? AND GZCPDM=? and "");
            //sbSql.append("" GZZHDM like '1104__01_%' ) pz2 "");
            sbSql.append("" (KMCODE = GZKMDM AND  KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZCZQ' AND KMZQLS <> 'FZ' ) ) pz2 "");
            sbSql.append("" full join (SELECT GZZHDM,GZZQDM,GZGZSL FROM TGCORE.EVLGZ,TGCORE.MONKM WHERE GZDATE=? AND GZCPDM=? AND "");
            //sbSql.append("" GZZHDM like '1104__01_%') gz2 "");
            sbSql.append("" (KMCODE = GZKMDM AND  KMCPLX = ? AND ISFINAL = 'Y' AND KMTYPE = 'CB' AND KMZQLX = 'ZCZQ' AND KMZQLS <> 'FZ' )) gz2  "");
            sbSql.append("" on pz2.GZZHDM=gz2.GZZHDM "");
            paras = new Object[]{lastWorkDate, cpdm, kmcplx, date, cpdm, kmcplx};
            mapList.addAll(queryForList(sbSql.toString(), paras));
        }
        return mapList;
    }"
"    public List<String> getHoldFundCode(Date monDate, String prdCode, String subjectType) throws MonitorBussException, MonitorSystException {
        String sql = """";
        sql = ""select distinct GZZQDM from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM= ? and GZDATE= ?  "" +
                ""and GZKMDM=KMCODE  and KMCPLX= ?  and ISFINAL='Y' and KMZQLX in('JJ') AND KMTYPE ='CB' and KMZQLS <> 'FZ'"";
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        try {
            return jdbcTemplate.queryForList(sql, new Object[]{prdCode, monDate, subjectType}, new RowMapper<String>() {
                @Override
                public String mapRow(ResultSet rs, int count) throws Exception {
                    return rs.getString(""GZZQDM"");
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓基金代码失败"", e);
        }

    }"
"    public List<Map<String, Object>> getFundHoldingInfo(final Date evlDate, final Date chDate,
                                                        final String prdCode, final String subjectType)
            throws SQLException {
        StringBuilder sql = new StringBuilder(256);
        sql.append(""with "");
        sql.append(""holdjj as (select GZZQDM as SECCODE, KMMKET as MARKET, sum(GZSZZE) as AMOUNT "");
        sql.append(""   from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? and GZKMDM=KMCODE "");
        sql.append(""   and KMCPLX=? and KMZQLX='JJ' and KMTYPE='CB' and ISFINAL='Y' group by GZZQDM, KMMKET), "");

        sql.append(""fund as (select JJCODE,JJMKET,JJNAME,JJDATE,JJSILB from TGCORE.MONJJ where JJDATE=?) "");

        sql.append(""select SECCODE,MARKET,JJNAME as SECNAME,AMOUNT,JJSILB as SILB, 1 as SYQX, '货币基金' as SECTYPE ""
                        + ""from holdjj left join fund on JJCODE=SECCODE and JJMKET=MARKET "")
                .append(""where JJSILB in ('HB') or JJSILB is NULL"");
        Object[] args = {prdCode, evlDate, subjectType, chDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<Map<String, Object>> getFundHoldingInfo4PreMon(final java.util.Date monDate, final java.util.Date evlDate,
                                                               final java.util.Date chDate, final String prdCode,
                                                               final String subjectType)
            throws SQLException {
        CalendarUtil calendarUtil = SpringContextUtil.getBean(CalendarUtil.class);
        StringBuilder sql = new StringBuilder(256);
        sql.append(""with "");
        sql.append(""holdjj as (select GZZQDM as SECCODE, KMMKET as MARKET, GZSZZE "");
        sql.append(""   from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? and GZKMDM=KMCODE "");
        sql.append(""   and KMCPLX=? and KMZQLX='JJ' and KMTYPE='CB' and ISFINAL='Y' "");
        sql.append("" union all "");
        //这里基金取今日指令的和昨天入库的，因为申购的基金在T+1日才入到估值表
        sql.append("" select zljjdm as SECCODE, ZLMKET as MARKET, zljyje as GZSZZE from  tgcore.MON_ZL_JJSGZL where zlcpdm""
                + "" = ? and zldate between ? and ? "");
        sql.append("" ),"");

        sql.append(""holdhz as (select SECCODE,MARKET,SUM(GZSZZE) as AMOUNT from holdjj group by SECCODE,MARKET),"");

        sql.append(""fund as (select JJCODE,JJMKET,JJNAME,JJDATE,JJSILB from TGCORE.MONJJ where JJDATE=?) "");

        sql.append(""select SECCODE,MARKET,JJNAME as SECNAME,AMOUNT,JJSILB as SILB,1 as SYQX,'货币基金' as SECTYPE ""
                        + ""from holdhz left join fund on JJCODE=SECCODE and JJMKET=MARKET "")
                .append(""where JJSILB in ('HB') or JJSILB is NULL"");
        Object[] args = {prdCode, evlDate, subjectType,
                prdCode, calendarUtil.obtainLastWorkDay(monDate.toString()), monDate,
                chDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<Map<String, Object>> getFundHoldingInfo4PreMon4Detail(final java.util.Date monDate, final java.util.Date evlDate,
                                                               final java.util.Date chDate, final String prdCode,
                                                               final String subjectType)
            throws SQLException {
        CalendarUtil calendarUtil = SpringContextUtil.getBean(CalendarUtil.class);
        StringBuilder sql = new StringBuilder(256);
        sql.append(""with "");
        sql.append(""holdjj as (select GZZQDM as SECCODE, KMMKET as MARKET,'T-1' AS SQDATAFROM, GZSZZE "");
        sql.append(""   from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? and GZKMDM=KMCODE "");
        sql.append(""   and KMCPLX=? and KMZQLX='JJ' and KMTYPE='CB' and ISFINAL='Y' "");
        sql.append("" union all "");
        //这里基金取今日指令的和昨天入库的，因为申购的基金在T+1日才入到估值表
        sql.append("" select zljjdm as SECCODE, ZLMKET as MARKET,'T' AS SQDATAFROM, zljyje as GZSZZE from  tgcore.MON_ZL_JJSGZL where zlcpdm""
                + "" = ? and zldate between ? and ? "");
        sql.append("" ),"");

        sql.append(""holdhz as (select SECCODE,MARKET,SQDATAFROM,GZSZZE as AMOUNT from holdjj),"");

        sql.append(""fund as (select JJCODE,JJMKET,JJNAME,JJDATE,JJSILB from TGCORE.MONJJ where JJDATE=?) "");

        sql.append(""select SECCODE,MARKET,SQDATAFROM,JJNAME as SECNAME,AMOUNT,JJSILB as SILB,1 as SYQX,'货币基金' as SECTYPE ""
                        + ""from holdhz left join fund on JJCODE=SECCODE and JJMKET=MARKET "")
                .append(""where JJSILB in ('HB') or JJSILB is NULL"");
        Object[] args = {prdCode, evlDate, subjectType,
                prdCode, calendarUtil.obtainLastWorkDay(monDate.toString()), monDate,
                chDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<Map<String, Object>> getFundHolding(String prdCode, java.util.Date evlDate, String subjectType)
            throws SQLException {
        String sql = ""with FUND as (select GZZQDM, KMMKET, GZSZZE, case KMTYPE when 'JZZB01' then 0 when 'JZZB02' then 0 when 'JZZB03' then 0 ""
                + "" else GZCBZE END GZCBZE  from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? and GZKMDM=KMCODE and KMCPLX=? and KMTYPE in ""
                + "" ('CB','YZ','JZZB01','JZZB02','JZZB03') and KMZQLX='JJ' and KMZQLS<>'FZ' and ISFINAL = 'Y'), ""
                + "" JJ AS (SELECT JJCODE, JJNAME, JJTYPE, JJDATE, JJMKET FROM TGCORE.MONJJ WHERE JJDATE= ? ) ""
                + "" select GZZQDM, KMMKET, GZSZZE, GZCBZE, JJCODE SECCODE, JJNAME SECNAME, JJTYPE SECTYPE from FUND inner join JJ ON ""
                + "" KMMKET=JJMKET and JJCODE=GZZQDM"";
        Object[] args = {prdCode, evlDate, subjectType, evlDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<Map<String, Object>> getGzQhHolding(String prdCode, java.util.Date evlDate, String subjectType) throws SQLException {
        String sql = ""select GZZQDM, KMMKET, GZSZZE, GZCBZE, GZZQDM SECCODE, ' ' SECNAME, 'GZQH' SECTYPE from TGCORE.EVLGZ,TGCORE.MONKM where ""
                + ""GZCPDM=? and GZDATE=? and GZKMDM = KMCODE and KMCPLX = ? and KMZQLX = 'GZQH' and KMZQLS<>'FZ' and ISFINAL = 'Y'"";
        Object[] args = {prdCode, evlDate, subjectType};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args);
    }"
"    public List<Map<String, Object>> getEvlHolding(final String prdcode, final DateParam dataParam, final String subjectType) throws SQLException {
        StringBuilder sql = new StringBuilder(1024);
        sql.append(""with gz as (select GZZQDM, KMMKET, (case KMZQLX when 'ZCZQ' then 'ZQ' else KMZQLX end) as zqlx, GZSZZE ""
                + ""from tgcore.EVLGZ, tgcore.MONKM where KMCPLX=? and GZDATE=? and GZCPDM=? and GZKMDM=KMCODE and  ""
                + ""((KMZQLX in ('JJ','GP') and KMTYPE='CB')""
                + "" or (KMZQLX in ('ZQ','ZCZQ') and KMTYPE in ('CB','YZ','LX'))) and ISFINAL='Y' and KMZQLS<>'FZ' ),"");
        sql.append(""ZL as (select ZLJJDM as GZZQDM,  ZLMKET as KMMKET,'JJ' as zqlx, ZLJYJE as GZSZZE from tgcore.MON_ZL_JJSGZL ""
                + ""where ZLCPDM=? and (ZLDATE = ? or ZLDATE=?) ""
                + ""union all ""
                + ""select ZLZQDM as GZZQDM, ZLMKET as KMMKET, 'GP' as zqlx, zljyje as gzszze from tgcore.MON_ZL_WXXGZL ""
                + ""where ZLCPDM=? and ZLDATE=? ""
                + ""union all ""
                + ""select ZLZQDM as GZZQDM, ZLMKET as KMMKET, 'GP' as zqlx, zljyje as gzszze from tgcore.MON_ZL_BJTLZL ""
                + ""where ZLCPDM=? and ZLDATE=? ""
                + ""union all ""
                + ""select ZLZQDM as GZZQDM, 'Y' as KMMKET, 'ZQ' as zqlx, ZLQJJE as gzszze from tgcore.MON_ZL_YHJZQZL ""
                + ""where ZLCPDM=? and ZLDATE=? ""
                + ""union all ""
                + ""select ZLZQDM as GZZQDM, ZLMKET as KMMKET, 'ZQ' as zqlx, zljyje as gzszze from tgcore.MON_ZL_WXXZZL ""
                + ""where ZLCPDM=? and ZLDATE=? ""
                + ""union all ""
                + ""select ZLZQDM as GZZQDM, ZLMKET as KMMKET, 'ZQ' as zqlx, zljyje as gzszze from tgcore.MON_ZL_HSTLZL ""
                + ""where ZLCPDM=? and ZLDATE=? ""
                + ""),"");
        sql.append(""un as (select gzzqdm,kmmket,zqlx,gzszze from zl ""
                + ""union all select gzzqdm,kmmket,zqlx,gzszze from gz ""
                + ""union all select gzzhdm as gzzqdm, ' ' as kmmket, (case gzzhdm when '99990004' then 'JZ' else 'ZZ' end) as zqlx, gzszze ""
                + ""from tgcore.EVLGZ where GZDATE=? and GZCPDM=? and GZZHDM in ('99990001','99990004')) "");
        sql.append(""select gzzqdm,kmmket,zqlx, sum(gzszze) je from un group by gzzqdm,kmmket,zqlx"");
        Object[] args = new Object[]{subjectType, dataParam.getEvlDate(), prdcode,
                prdcode, dataParam.getMonDate(), dataParam.getLastWorkDay(),
                prdcode, dataParam.getMonDate(),
                prdcode, dataParam.getMonDate(),
                prdcode, dataParam.getMonDate(),
                prdcode, dataParam.getMonDate(),
                prdcode, dataParam.getMonDate(),
                dataParam.getEvlDate(), prdcode};
        JdbcTemplate jdbc = new JdbcTemplate();
        return jdbc.queryForList(sql.toString(), args);
    }"
"    public Set<String> getCcZqs(String prdCode, Date busDate, String subjectPrdType, String prdType) throws MonitorBussException,
            MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        if (ZbConstants.CPLX_QD.equals(prdType)) {
            sbSql.append(""select KMMKET GZMKET, SECCODE as GZZQDM from TGCORE.EVALUATION,TGCORE.MONKM where PRDCODE=? and BIZDATE=? and ""
                    + ""KMCODE=COACODE "");
        } else {
            sbSql.append(""select KMMKET GZMKET, GZZQDM from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? and KMCODE=GZKMDM "");
        }

        sbSql.append(""and KMCPLX=? and KMZQLX in ('ZQ', 'ZCZQ', 'GP', 'QZ', 'JJ','GZQH','SPQH','ZQQH','HLQH','JSQH') "");
        sbSql.append(""and ISFINAL='Y' and KMTYPE='CB' and KMZQLS<>'FZ' "");

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            List<Map<String, Object>> securities = jdbc.queryForList(sbSql.toString(), prdCode, busDate, subjectPrdType);
            Set<String> secSet = new HashSet<>(securities.size());
            for (Map<String, Object> sec : securities) {
                secSet.add(sec.get(""GZMKET"").toString() + sec.get(""GZZQDM"").toString().trim());
            }
            return secSet;
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓证券失败"", e);
        }
    }"
"    public List<Map<String, Object>> getCKAndZQAmount4Bank(String prdCode, java.sql.Date monDate, String subjectType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sSql = new StringBuilder();

        sSql.append(""WITH CPMN AS (SELECT DISTINCT CPMNAM FROM TGCORE.MONPR WHERE CPCODE = ?),"");
        sSql.append(
                ""CP AS (SELECT CPCODE,PR.CPMNAM AS CPMNAM FROM TGCORE.MONPR PR INNER JOIN CPMN ON PR.CPMNAM = CPMN.CPMNAM WHERE CPCPLX = 'YC' AND CPTTYPE = 'XJGL'),"");
        sSql.append(""DA AS (SELECT CPCODE,CPMNAM,GZZHDM, GZZQDM, GZCBZE, GZSZZE,KMZQLX,KMMKET, KMZQLS,SECTYPE3 "" +
                ""FROM TGCORE.EVLGZ gz, TGCORE.MONKM km ,CP "" +
                ""WHERE gz.GZDATE = ? AND gz.GZKMDM = km.KMCODE AND cp.CPCODE = gz.GZCPDM AND km.ISFINAL = 'Y' AND km.KMZQLX IN ('ZQ','CK') AND km.KMCPLX = ?  AND km.KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') AND km.KMZQLS<>'FZ'),"");
        sSql.append(""YHQC as (select distinct ZGJGJC,ZGJGQC,ZGJJZC from TGCORE.MONZG where ZGDATE=?),"");
        sSql.append(
                ""YHZQ AS (SELECT ZQ.ZQFXRN AS YH, ZGJJZC, GZSZZE  FROM DA,TGCORE.MONZQ ZQ ,YHQC ZG WHERE ZQ.ZQCODE = DA.GZZQDM AND ZQ.ZQMKET = DA.KMMKET AND ZQ.ZQFXRN = ZG.ZGJGQC AND DA.KMZQLX = 'ZQ' AND ZQ.ZQDATE = ?  ""
                        +
                        ""UNION ALL "" +
                        ""SELECT ZG.ZGJGQC AS YH, ZGJJZC, GZSZZE FROM DA, TGCORE.EVLDQ DQ , YHQC ZG WHERE DA.CPCODE = DQ.DQCPDM AND DA.GZZHDM = DQ.DQDQZH AND DQ.DQCKYH = ZG.ZGJGJC AND KMZQLS != 'HQ' AND  DA.KMZQLX = 'CK' AND DQSTAT='A'  AND DQSTRD<=? AND DQENDD>?  ""
                        +
                        ""union ALL select ZGJGQC as YH, ZGJJZC, GZSZZE from DA, YHQC WHERE KMZQLS = 'HQ' AND SECTYPE3 != 'THHQ' AND ZGJGQC = ""
                        + ""'招商银行股份有限公司' UNION ALL SELECT ZG.ZGJGQC AS YH, ZGJJZC, GZSZZE ""
                        + ""FROM DA, TGCORE.EVLDQ DQ , YHQC  ZG WHERE DA.CPCODE = DQ.DQCPDM AND DA.GZZHDM = DQ.DQDQZH AND""
                        + "" DQ.DQCKYH = ZG.ZGJGJC AND DA.KMZQLX =  'CK' AND KMZQLS = 'HQ' AND DQSTAT='A'  AND DQSTRD<=? AND DQENDD>?  )"");
        sSql.append(""SELECT YH,ZGJJZC, SUM(GZSZZE) AS GZSZZE FROM YHZQ GROUP BY YH,ZGJJZC"");
        try {
            JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
            Object[] args = new Object[]{prdCode, monDate, subjectType, monDate, monDate, monDate, monDate, monDate, monDate};
            List<Map<String, Object>> maps = jdbc.queryForList(sSql.toString(), args);
            return maps;
        } catch (Exception e) {
            throw new MonitorSystException(""查询债券、银行存款失败！"", e);
        }
    }"
"    public List<XjglckzqblEntity> getPreCKAndZQAmount4Bank(String prdCode, java.sql.Date monDate, String subjectType)
            throws MonitorSystException {
        StringBuilder sSql = new StringBuilder();

        sSql.append(""WITH CPMN AS (SELECT DISTINCT CPMNAM FROM TGCORE.MONPR WHERE CPCODE = ?),"");
        sSql.append(
                ""CP AS (SELECT CPCODE,PR.CPMNAM AS CPMNAM FROM TGCORE.MONPR PR INNER JOIN CPMN ON PR.CPMNAM = CPMN.CPMNAM WHERE CPCPLX = 'YC' AND CPTTYPE = 'XJGL'),"");
        sSql.append(""DA AS (SELECT CPCODE,CPMNAM,GZZHDM, GZZQDM, GZCBZE, GZSZZE,KMZQLX,KMMKET, KMZQLS,SECTYPE3 "" +
                ""FROM TGCORE.EVLGZ gz, TGCORE.MONKM km ,CP "" +
                ""WHERE gz.GZDATE = ? AND gz.GZKMDM = km.KMCODE AND cp.CPCODE = gz.GZCPDM AND km.ISFINAL = 'Y' AND km.KMZQLX IN ('ZQ','CK') AND km.KMCPLX = ?  AND km.KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') AND km.KMZQLS<>'FZ'),"");
        sSql.append(""YHQC as (select distinct ZGJGJC,ZGJGQC,ZGJJZC from TGCORE.MONZG where ZGDATE=?),"");
        sSql.append(
                ""YHZQ AS (SELECT ZQ.ZQFXRN AS YH, ZGJJZC, GZSZZE ,CPCODE,ZQCODE,ZQNAME,ZQMKET,'债券' AS ZQTYPE  FROM""
                        + "" DA,TGCORE.MONZQ ZQ ,YHQC ZG WHERE ZQ.ZQCODE = DA.GZZQDM AND ZQ.ZQMKET = DA.KMMKET AND ZQ.ZQFXRN = ZG.ZGJGQC AND DA.KMZQLX = 'ZQ' AND ZQ.ZQDATE = ?  ""
                        +
                        ""UNION ALL "" +
                        ""SELECT ZG.ZGJGQC AS YH, ZGJJZC, GZSZZE ,CPCODE,DQCJBH ZQCODE,' ' ZQNAME,' ' ZQMKET,'定期存款' AS ZQTYPE  FROM ""
                        + ""DA, TGCORE.EVLDQ DQ , YHQC ZG WHERE DA.CPCODE = DQ.DQCPDM AND DA.GZZHDM = DQ.DQDQZH AND DQ.DQCKYH = ZG.ZGJGJC AND KMZQLS != 'HQ' AND  DA.KMZQLX = 'CK' AND DQSTAT='A'  AND DQSTRD<=? AND DQENDD>?  ""
                        +
                        ""union ALL select ZGJGQC as YH, ZGJJZC, GZSZZE ,CPCODE,GZZHDM ZQCODE,' ' ZQNAME,' ' ZQMKET,'活期存款' AS ZQTYPE  from DA, YHQC WHERE KMZQLS = 'HQ' AND SECTYPE3 != 'THHQ' AND ZGJGQC = ""
                        + ""'招商银行股份有限公司' "" +
                        ""UNION ALL "" +
                        ""SELECT ZG.ZGJGQC AS YH, ZGJJZC, GZSZZE,CPCODE,DQCJBH ZQCODE,' ' ZQNAME,' ' ZQMKET,'活期存款' AS ZQTYPE ""
                        + ""FROM DA, TGCORE.EVLDQ DQ , YHQC  ZG WHERE DA.CPCODE = DQ.DQCPDM AND DA.GZZHDM = DQ.DQDQZH AND""
                        + "" DQ.DQCKYH = ZG.ZGJGJC AND DA.KMZQLX =  'CK' AND KMZQLS = 'HQ' AND DQSTAT='A'  AND DQSTRD<=? AND DQENDD>?  )"");
        sSql.append(""SELECT YH,CPCODE,ZQCODE,ZQNAME,ZQMKET,ZQTYPE,ZGJJZC,GZSZZE FROM YHZQ"");
        try {
            JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
            Object[] args = new Object[]{prdCode, monDate, subjectType, monDate, monDate, monDate, monDate, monDate, monDate};
            List<XjglckzqblEntity> maps = jdbc.queryForList(sSql.toString(), args, (rs, rowNum) -> {
                XjglckzqblEntity res = new XjglckzqblEntity();
                res.setBank(rs.getString(""YH""));
                res.setPrdCode(rs.getString(""CPCODE""));
                res.setSecCode(rs.getString(""ZQCODE""));
                res.setSecName(rs.getString(""ZQNAME""));
                res.setSecMket(rs.getString(""ZQMKET""));
                res.setSecType(rs.getString(""ZQTYPE""));
                res.setZgjjzc(rs.getBigDecimal(""ZGJJZC""));
                res.setMarketTotal(rs.getBigDecimal(""GZSZZE""));
                // T表示指令，T-1表示非指令
                res.setSqdatafrom(""T-1"");
                return res;
            });
            return maps;
        } catch (Exception e) {
            throw new MonitorSystException(""查询债券、银行存款失败！"", e);
        }
    }"
"    public List<XjglckzqblEntity> getCKAndZQAmount4BankDetail(String prdCode, java.sql.Date monDate, String subjectType, String assistKey)
            throws MonitorSystException {
        StringBuilder sSql = new StringBuilder();
        sSql.append(""WITH CPMN AS (SELECT DISTINCT CPMNAM FROM TGCORE.MONPR WHERE CPCODE = ?),"");
        sSql.append(
                ""CP AS (SELECT CPCODE,PR.CPMNAM AS CPMNAM FROM TGCORE.MONPR PR INNER JOIN CPMN ON PR.CPMNAM = CPMN.CPMNAM WHERE CPCPLX = 'YC' AND CPTTYPE = 'XJGL'),"");
        sSql.append(""DA AS (SELECT CPCODE,CPMNAM,GZZHDM, GZZQDM, GZCBZE, GZSZZE,KMZQLX,KMMKET, KMZQLS, SECTYPE3 "" +
                ""FROM TGCORE.EVLGZ gz, TGCORE.MONKM km ,CP "" +
                ""WHERE gz.GZDATE = ? AND gz.GZKMDM = km.KMCODE AND cp.CPCODE = gz.GZCPDM AND km.ISFINAL = 'Y' AND km.KMZQLX IN ('ZQ','CK') AND km.KMCPLX = ?  AND km.KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') AND km.KMZQLS<>'FZ'),"");
        sSql.append(""YHQC as (select distinct ZGJGJC,ZGJGQC,ZGJJZC from TGCORE.MONZG where ZGDATE=?),"");
        sSql.append(
                ""YHZQ AS (SELECT ZQ.ZQFXRN AS YH, ZGJJZC, GZSZZE,CPCODE,ZQCODE,ZQNAME,ZQMKET,'债券' AS ZQTYPE  FROM DA,TGCORE.MONZQ ZQ ,YHQC ZG WHERE ZQ.ZQCODE = DA.GZZQDM AND ZQ.ZQMKET = DA.KMMKET AND ZQ.ZQFXRN = ZG.ZGJGQC AND DA.KMZQLX = 'ZQ' AND ZQ.ZQDATE = ?  ""
                        +
                        ""UNION ALL "" +
                        ""SELECT ZG.ZGJGQC AS YH, ZGJJZC, GZSZZE,CPCODE,DQCJBH ZQCODE,' ' ZQNAME,' ' ZQMKET,'定期存款' AS ZQTYPE FROM DA, TGCORE.EVLDQ DQ , YHQC ""
                        + ""ZG WHERE DA.CPCODE = DQ.DQCPDM AND DA.GZZHDM = DQ.DQDQZH AND DQ.DQCKYH = ZG.ZGJGJC AND DA.KMZQLX = 'CK' AND KMZQLS != ""
                        + ""'HQ' AND DQSTAT='A'  AND DQSTRD<=? AND DQENDD>?  "" +
                        ""union ALL select ZGJGQC as YH, ZGJJZC, GZSZZE,CPCODE,GZZHDM ZQCODE,' ' ZQNAME,' ' ZQMKET,'活期存款' AS ZQTYPE from DA, YHQC ""
                        + ""WHERE KMZQLS = 'HQ' AND SECTYPE3 != 'THHQ' AND ZGJGQC = '招商银行股份有限公司'  ""
                        + ""UNION ALL SELECT ZG.ZGJGQC AS YH, ZGJJZC, GZSZZE,CPCODE,DQCJBH ZQCODE,' ' ZQNAME,' ' ZQMKET,'活期存款' AS ZQTYPE FROM DA, ""
                        + ""TGCORE.EVLDQ DQ , YHQC  ZG WHERE DA.CPCODE = DQ.DQCPDM AND DA.GZZHDM = DQ.DQDQZH AND DQ.DQCKYH = ZG.ZGJGJC AND DA.KMZQLX =""
                        + "" 'CK' AND KMZQLS = 'HQ' AND DQSTAT='A'  AND DQSTRD<=? AND DQENDD>?  )"");
        sSql.append(""SELECT YH,CPCODE,ZQCODE,ZQNAME,ZQMKET,ZQTYPE,ZGJJZC,GZSZZE FROM YHZQ"");
        try {
            JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
            Object[] args = new Object[]{prdCode, monDate, subjectType, monDate, monDate, monDate, monDate, monDate, monDate};
            List<XjglckzqblEntity> maps = jdbc.queryForList(sSql.toString(), args, (rs, rowNum) -> {
                XjglckzqblEntity res = new XjglckzqblEntity();
                res.setBank(rs.getString(""YH""));
                res.setPrdCode(rs.getString(""CPCODE""));
                res.setSecCode(rs.getString(""ZQCODE""));
                res.setSecName(rs.getString(""ZQNAME""));
                res.setSecMket(rs.getString(""ZQMKET""));
                res.setSecType(rs.getString(""ZQTYPE""));
                res.setZgjjzc(rs.getBigDecimal(""ZGJJZC""));
                res.setMarketTotal(rs.getBigDecimal(""GZSZZE""));
                return res;
            });
            return maps;
        } catch (Exception e) {
            throw new MonitorSystException(""查询债券、银行存款失败！"", e);
        }
    }"
"    public Map<String, Object> getPreMonCKAndZQAmount4Bank(
            String prdCode, String secType, String bankFullName, java.sql.Date monDate, String subjectType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sSql = new StringBuilder();
        Object[] args;
        sSql.append(""WITH CPMN AS (SELECT DISTINCT CPMNAM FROM TGCORE.MONPR WHERE CPCODE = ?),"");
        sSql.append(""CP AS (SELECT CPCODE,PR.CPMNAM AS CPMNAM FROM TGCORE.MONPR PR INNER JOIN CPMN ON PR.CPMNAM = CPMN.CPMNAM WHERE CPCPLX = 'YC' AND CPTTYPE = 'XJGL'),"");
        sSql.append(""DA AS (SELECT CPCODE,CPMNAM,GZZHDM, GZZQDM, GZCBZE, GZSZZE,KMZQLX "" +
                ""FROM TGCORE.EVLGZ gz, TGCORE.MONKM km ,CP "" +
                ""WHERE gz.GZDATE = ? AND gz.GZKMDM = km.KMCODE AND cp.CPCODE = gz.GZCPDM AND km.ISFINAL = 'Y' AND km.KMCPLX = ? AND km.KMZQLS<>'FZ' "");
        if (ZbConstants.ZQLB_ZQ.equals(secType)) {
            sSql.append("" AND km.KMZQLX = 'ZQ' AND km.KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03')"");
        } else {
            sSql.append(""AND km.KMZQLX = 'CK' AND km.KMTYPE = 'CB'"");
        }
        sSql.append(""),"");
        if (ZbConstants.ZQLB_ZQ.equals(secType)) {
            sSql.append(""YHZQ AS (SELECT ZQ.ZQFXRN AS YH, ZGJJZC, DA.*  "" +
                    ""FROM DA,TGCORE.MONZQ ZQ ,TGCORE.MONZG ZG WHERE ZQ.ZQCODE = DA.GZZQDM AND ZQ.ZQFXRN = ZG.ZGJGQC AND DA.KMZQLX = 'ZQ' AND ZG.ZGJGQC = ? )"");
            args = new Object[]{prdCode, monDate, subjectType, bankFullName};
        } else {
            sSql.append(""fxryh AS (SELECT DISTINCT ZGJGQC,ZGJJZC,DQDQZH,DQCPDM  FROM TGCORE.MONZG ZG,TGCORE.EVLDQ DQ WHERE ZG.ZGJGQC = ? AND DQ.DQCKYH = ZG.ZGJGJC  AND DQSTAT='A' AND ZGDATE = ?  AND DQSTRD<=? AND DQENDD>?),"");
            sSql.append(""YHZQ AS (SELECT fxryh.ZGJGQC AS YH,ZGJJZC, DA.* FROM fxryh LEFT JOIN DA ON DA.CPCODE = fxryh.DQCPDM AND DA.GZZHDM = fxryh.DQDQZH WHERE DA.KMZQLX = 'CK' ) "");
            args = new Object[]{prdCode, monDate, subjectType, bankFullName, monDate, monDate, monDate};
        }
        sSql.append(""SELECT YH,ZGJJZC, SUM(GZSZZE) AS GZSZZE FROM YHZQ GROUP BY YH,ZGJJZC"");
        try {
            JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
            return jdbc.queryForObject(sSql.toString(), args, new RowMapper<Map<String, Object>>() {
                @Override
                public Map<String, Object> mapRow(ResultSet rs, int rowNum) throws Exception {
                    Map<String, Object> res = new HashMap<>();
                    res.put(""YH"", rs.getString(""YH""));
                    res.put(""ZGJJZC"", rs.getBigDecimal(""ZGJJZC""));
                    res.put(""GZSZZE"", rs.getBigDecimal(""GZSZZE""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""查询债券、银行存款失败！"", e);
        }
    }"
"    public List<Map<String, Object>> getHoldingOverTheCounterOptions(final String prdcode, final Date bizdate, final String subjectType)
            throws MonitorBussException {
        StringBuilder sql = new StringBuilder(256);
        sql.append(""with evl as (select GZDATE,GZCPDM, GZZQDM, KMZQLS from tgcore.EVLGZ, tgcore.MONKM where GZKMDM=KMCODE "")
                .append(""and GZCPDM=? and GZDATE=? and KMCPLX=? and KMTYPE='CB' and KMZQLX='CWQQ' and ISFINAL='Y'),"");
        sql.append(""cwqq as (select GZDATE,GZCPDM, GZZQDM, KMZQLS, HYNAME, HYJYDS, HYFQQF from evl left join tgcore.PRDCWQQ "")
                .append(""on GZCPDM=HYCPDM and GZZQDM=HYHYDM and HYSTAT='A')"");
        sql.append(""select GZZQDM, HYNAME,HYJYDS as JYDS,HYFQQF, BZJJE,NVL(HYFQQF,0) + NVL(BZJJE,0) as JE from cwqq "")
                .append(""left join tgcore.GUARANTEE_MONEY_ADJUST "")
                .append(""on GZCPDM=PRDCODE and GZZQDM=HYCODE and GZDATE=JYDATE and YWTYPE='QQ' and STATUS='A'"");
        Object[] args = new Object[]{prdcode, bizdate, subjectType};
        JdbcTemplate jdbc = new JdbcTemplate();
        try {
            return jdbc.queryForList(sql.toString(), args);
        } catch (Exception e) {
            throw new MonitorBussException(""获取持仓的场外期权失败："", e);
        }
    }"
"    public List<Map<String, Object>> getStockHoldingsByManger(String manager, String prdCode, Date monDate,
                                                              String subjectType, boolean isBxOrQD) throws MonitorBussException {
        String cpcc;
        if (isBxOrQD) {
            cpcc = ""cpcc as (select SECCODE as GZZQDM,KMMKET from TGCORE.EVALUATION,km where PRDCODE=? and BIZDATE=? and ""
                    + ""KMCPLX=? and COACODE=KMCODE),"";
        } else {
            cpcc = ""cpcc as (select GZZQDM,KMMKET from TGCORE.EVLGZ,km where GZCPDM=? and GZDATE=? and KMCPLX=? and GZKMDM=KMCODE),"";
        }
        StringBuilder sql = new StringBuilder();
        sql.append(""with cp as (select cpcode, cpcplx, CPMNAM from TGCORE.MONPR where ""
                + ""upper(REGEXP_REPLACE(CPMNAM, '[^A-Za-z0-9一-龥]')) = '"" + manager + ""' and CPSTAT = 'A'), ""
                + ""km as(select CASE KMCPLX WHEN 'BX' THEN (CASE KMMKET WHEN 'G' THEN 'X' ELSE KMMKET END) ELSE KMMKET ""
                + ""END AS KMMKET,KMCPLX,KMCODE,KMZQLX,kmzqls,SECTYPE3,KMTZFL,KMTYPE,KMKMBZ,KMBZXX from TGCORE.MONKM where ""
                + ""KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03') and ISFINAL='Y' and KMZQLX = 'GP' and KMZQLS <> 'FZ' ""
                + ""and KMKMBZ = 'CNY' and KMBZXX <> 'OVERSEA'),""
                + ""cpkm as( select CPCODE,CPCPLX,SUBJECT_TYPE,CPMNAM from cp join (select PRD_TYPE,SUBJECT_TYPE,""
                + ""ROW_NUMBER() over(partition by PRD_TYPE order by SEQN desc) as rn ""
                + ""from TGCORE.MON_PROD_SUBJECT where ? between START_DATE and END_DATE) on CPCPLX=PRD_TYPE and rn=1 ),""
                + ""glrcpcc as (select PRDCODE as GZCPDM,BIZDATE as GZDATE,ACCCODE as GZZHDM,SECCODE as GZZQDM,""
                + ""EVLQTY as gzgzsl,KMZQLX,kmzqls,KMMKET,COACODE as GZKMDM,KMKMBZ,KMBZXX,CPMNAM ""
                + ""from TGCORE.EVALUATION gz,km,cpkm where PRDCODE=CPCODE and BIZDATE=? and COACODE=KMCODE and KMCPLX=SUBJECT_TYPE ""
                + ""union all ""
                + ""select GZCPDM,GZDATE,GZZHDM,GZZQDM,gzgzsl,KMZQLX,kmzqls,KMMKET,GZKMDM,KMKMBZ,KMBZXX,CPMNAM ""
                + ""from TGCORE.EVLGZ gz,km,cpkm where GZCPDM=CPCODE and GZDATE=? and GZKMDM=KMCODE and KMCPLX=SUBJECT_TYPE), ""
                + cpcc
                + ""glrkmgz as (select GZCPDM,GZDATE,GZZHDM,GZZQDM,gzgzsl,KMZQLX,kmzqls,KMMKET,GZKMDM,CPMNAM ""
                + ""from glrcpcc glr where exists( select 1 from cpcc where glr.gzzqdm=cpcc.gzzqdm and glr.KMMKET=cpcc.KMMKET)) ""
                + ""select GZCPDM,GZZHDM,GZZQDM,KMMKET,CPMNAM,gzgzsl,GPCODE,GPNAME,GPLTGB from glrkmgz left join ""
                + ""tgcore.mongp on KMMKET=GPMKET and GZZQDM=GPCODE and GZDATE=GPDATE"");

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sql.toString(), monDate, monDate, monDate, prdCode, monDate, subjectType);
        } catch (Exception e) {
            throw new MonitorBussException(""获取同一实控人股票持仓数据失败"", e);
        }
    }"
"    public List<TyglrtyzqblEntity> getBondHoldingsByManger(String manager, String prdCode, Date monDate, String subjectType,
                                                           boolean isShowDetail, boolean isBxOrQD) throws MonitorBussException {
        String cczq;
        if (isBxOrQD) {
            cczq = ""cczq as (select SECCODE as GZZQDM, KMMKET from tgcore.EVALUATION, tgcore.MONKM where PRDCODE=? and BIZDATE=? and ""
                    + ""KMCPLX=? and COACODE=KMCODE and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ'),"";
        } else {
            cczq = ""cczq as (select GZZQDM, KMMKET from tgcore.EVLGZ, tgcore.MONKM where GZCPDM=? and GZDATE=? and KMCPLX=? and ""
                    + ""GZKMDM=KMCODE and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ'),"";
        }
        StringBuilder sql = new StringBuilder();
        sql.append(""with zq as (select ZQCODE, ZQMKET,ZQNAME, ZQCLGM, ZQZQLB from tgcore.MONZQ where ZQDATE=? and ZQSTAT='A' and ZQSYFW='P'),"");
        //本产品持仓债券
        sql.append(cczq);
        sql.append(""cczqgm as (select GZZQDM, KMMKET, ZQNAME, ZQCLGM, ZQZQLB from cczq left join zq ""
                + ""on ZQMKET =KMMKET and ZQCODE = GZZQDM where ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','KZZ','JHGS') or ZQZQLB is null),"");
        //本产品持仓质押债券
        sql.append(""zyq as (select ZYZYDM as GZZQDM,ZYMKET as KMMKET from tgcore.JYSQTQS, TGCORE.JYSNHGZY where ZYCPDM=QSCPDM and ""
                + ""ZYDATE=QSQTRQ and ZYMKET=QSMKET and ZYCRTD<? and ZYSTAT='A' ""
                + ""and QSCJBH=ZYCJBH and QSCPDM=? and QSMMBZ='S' AND qsstat ='A' and qsywbz = 'ZQLQ'  AND qsqtrq <= ?  AND qsqtrq + qszqdm > ? ""
                + ""group by ZYZYDM, ZYMKET having sum(ZYCJSL) > 0),"");
        sql.append(""zyqgm as (select GZZQDM, KMMKET, ZQNAME, ZQCLGM, ZQZQLB from zyq, zq where ZQMKET =KMMKET and ZQCODE = GZZQDM ""
                + ""and ZQZQLB NOT IN ('GZ','YP','ZCJR','DFZ','KZZ','JHGS')),"");
        //本产品持仓的债券和质押券
        sql.append(""cpcc as (select GZZQDM, KMMKET, ZQNAME, ZQCLGM, ZQZQLB from cczqgm union select GZZQDM, KMMKET, ZQNAME, ""
                + ""ZQCLGM, ZQZQLB from zyqgm),"");
        //本产品的管理人下的所有产品
        sql.append(""glrcp as (select cpcode, cpcplx, cpmnam from TGCORE.MONPR where ""
                + ""upper(REGEXP_REPLACE(CPMNAM, '[^A-Za-z0-9一-龥]')) = '"" + manager + ""' and CPSTAT = 'A'), "");
        sql.append(""glrcpkm as( select CPCODE,CPCPLX,SUBJECT_TYPE,cpmnam from glrcp join (select PRD_TYPE,SUBJECT_TYPE,"" +
                ""ROW_NUMBER() over(partition by PRD_TYPE order by SEQN desc) as "" +
                ""rn from TGCORE.MON_PROD_SUBJECT where ? between START_DATE and END_DATE) a on CPCPLX=PRD_TYPE and rn=1 ), "");
        //管理人持仓本产品持仓的债券
        sql.append(""glrcczq as (select CPCODE, GZZHDM, GZZQDM, KMMKET, GZGZSL,cpmnam from tgcore.EVLGZ, tgcore.MONKM, glrcpkm ""
                + ""where GZCPDM=CPCODE and KMCPLX=SUBJECT_TYPE and ""
                + ""GZDATE=? and GZKMDM=KMCODE and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ' "");
        sql.append("" union all "");
        sql.append(""select CPCODE, ACCCODE as GZZHDM,SECCODE as GZZQDM, KMMKET, EVLQTY as GZGZSL,cpmnam from TGCORE.EVALUATION, tgcore.MONKM, glrcpkm ""
                + ""where PRDCODE=CPCODE and BIZDATE=? and COACODE=KMCODE and KMCPLX=SUBJECT_TYPE ""
                + ""and KMTYPE='CB' and ISFINAL='Y' and KMZQLX in ('ZQ', 'ZCZQ') and KMZQLS<>'FZ' and KMKMBZ='CNY' and KMBZXX<>'OVERSEA'"");
        sql.append("" union all "");
        sql.append("" select CPCODE, ' ' as GZZHDM,ZYZYDM as GZZQDM,ZYMKET as KMMKET, sum(ZYCJSL) as GZGZSL,cpmnam ""
                + ""from tgcore.JYSQTQS, TGCORE.JYSNHGZY, glrcpkm ""
                + ""where ZYCPDM=QSCPDM and ZYDATE=QSQTRQ and ZYMKET=QSMKET ""
                + ""and QSCJBH=ZYCJBH and QSCPDM=CPCODE and QSMMBZ='S' AND qsstat ='A' and qsywbz = 'ZQLQ'  AND qsqtrq <= ?  AND qsqtrq + qszqdm > ? ""
                + ""and ZYCRTD<? and ZYSTAT='A' group by CPCODE,ZYZYDM,ZYMKET,cpmnam having sum(ZYCJSL) > 0) "");

        if (isShowDetail) {
            sql.append("" select CPCODE, GZZHDM, glrcczq.GZZQDM, glrcczq.KMMKET, GZGZSL, ZQNAME, ZQCLGM, ZQZQLB, cpmnam from ""
                    + ""glrcczq, cpcc where glrcczq.GZZQDM=cpcc.GZZQDM and glrcczq.KMMKET=cpcc.KMMKET"");
        } else {
            sql.append("" select glrcczq.GZZQDM, glrcczq.KMMKET, sum(GZGZSL) as GZGZSL, ZQNAME, ZQCLGM, ZQZQLB, cpmnam from glrcczq, cpcc ""
                    + ""where glrcczq.GZZQDM=cpcc.GZZQDM and glrcczq.KMMKET=cpcc.KMMKET ""
                    + ""group by glrcczq.GZZQDM, glrcczq.KMMKET, ZQNAME, ZQCLGM, ZQZQLB, cpmnam"");
        }

        Object[] args = new Object[]{monDate,
                prdCode, monDate, subjectType,
                monDate, prdCode, monDate, monDate,
                monDate, monDate, monDate,
                monDate, monDate, monDate};

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbcTemplate.queryForList(sql.toString(), args, new RowMapper<TyglrtyzqblEntity>() {
                @Override
                public TyglrtyzqblEntity mapRow(final ResultSet rs, final int rowNum) throws Exception {
                    TyglrtyzqblEntity entity = new TyglrtyzqblEntity();
                    entity.setSecName(rs.getString(""ZQNAME""));
                    entity.setSecCode(rs.getString(""GZZQDM"").trim());
                    entity.setSecMarket(rs.getString(""KMMKET"").trim());
                    entity.setBondType(rs.getString(""ZQZQLB""));
                    entity.setGzgzsl(rs.getBigDecimal(""GZGZSL""));
                    entity.setScale(rs.getBigDecimal(""ZQCLGM""));
                    entity.setManager(rs.getString(""cpmnam""));
                    if (isShowDetail) {
                        entity.setAccount(rs.getString(""GZZHDM""));
                        entity.setPrdCode(rs.getString(""CPCODE""));
                    }
                    return entity;
                }
            });
        } catch(Exception e) {
            throw new MonitorBussException(""获取实控人持仓债券数据失败"", e);
        }
    }"
"    public List<SecurityBaseEntity> getForbiddenSpvHolding(String prdCode, Date monDate, String subjectType, String forbiddenType)
            throws SQLException {
        StringBuilder sql = new StringBuilder(128);
        sql.append(""with gz as (select GZZQDM, KMMKET from TGCORE.EVLGZ, TGCORE.MONKM where GZCPDM=? and GZDATE=? and KMCPLX=? and GZKMDM=KMCODE ""
                + ""and KMTYPE='CB' and ISFINAL='Y' and KMZQLX='SPV') "");
        sql.append(""select distinct GZZQDM,KMMKET, nvl(ZQNAME,' ') as ZQNAME, nvl(ZQZQLB,' ') as ZQZQLB from gz ""
                + ""left join (select * from TGCORE.MONSPV ""
                + ""where (ZQCODE,ZQCPDM) in (select ZQCODE,max(ZQCPDM) ZQCPDM from TGCORE.MONSPV where ZQCPDM=? or ZQCPDM=' ' group by ZQCODE) )""
                + ""on  ZQMKET =KMMKET and ZQCODE = GZZQDM where ZQZQLB in ("" + forbiddenType + "") or trim(ZQZQLB) is null "");
        Object[] args = new Object[]{prdCode, monDate, subjectType, prdCode};

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        return jdbcTemplate.queryForList(sql.toString(), args, new RowMapper<SecurityBaseEntity>() {
            @Override
            public SecurityBaseEntity mapRow(final ResultSet rs, final int rowNum) throws Exception {
                SecurityBaseEntity e = new SecurityBaseEntity();
                e.setSecCode(rs.getString(""GZZQDM"").trim());
                e.setSecType(rs.getString(""ZQZQLB"").trim());
                e.setSecMarket(rs.getString(""KMMKET"").trim());
                e.setSecName(rs.getString(""ZQNAME"").trim());
                return e;
            }
        });

    }"
"    public List<Map<String, Object>> getHoldingSpv(final String prdCode, final Date monDate, final String subjectType) throws MonitorBussException {
        StringBuilder sql = new StringBuilder(256);
        sql.append(""with evl as (select GZZQDM,KMMKET, GZSZZE, GZCBZE from tgcore.EVLGZ, TGCORE.MONKM where GZKMDM=KMCODE and GZCPDM=? "")
                .append(""and GZDATE=? and KMCPLX=? and KMTYPE in ('CB','JZZB01','JZZB02','JZZB03','YZ') and KMZQLX='SPV' and ISFINAL='Y')"");
        sql.append(""select GZZQDM, KMMKET, GZSZZE, GZCBZE, ZQNAME, ZQFXR, ZQZQLB, ZQEJLB,SFBJBZX from evl left join (select * from TGCORE.MONSPV "")
                .append(""where (ZQCODE,ZQCPDM) "")
                .append(""in (select ZQCODE,max(ZQCPDM) ZQCPDM from TGCORE.MONSPV where ZQCPDM=? or ZQCPDM=' ' group by ZQCODE)) "")
                .append(""on ZQMKET =KMMKET and ZQCODE = GZZQDM"");
        Object[] args = new Object[]{prdCode, monDate, subjectType, prdCode};

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try{
            return jdbc.queryForList(sql.toString(), args);
        } catch (Exception e) {
            throw new MonitorBussException(""获取持仓的非保本型收益凭证"", e);
        }
    }"
"    public List<Map<String, Object>> getHoldingSpv4Pre(final String prdCode, final Date gzDate, final Date monDate, final String subjectType,
                                                       final String fxr) throws MonitorBussException {
        StringBuilder sql = new StringBuilder(256);
        sql.append(""with evl as (select GZZQDM,KMMKET, GZSZZE, GZCBZE from tgcore.EVLGZ, TGCORE.MONKM where GZKMDM=KMCODE and GZCPDM=? "")
                .append(""and GZDATE=? and KMCPLX=? and KMTYPE in ('CB','JZZB01','JZZB02','JZZB03','YZ') and KMZQLX='SPV' and ISFINAL='Y'),"");
        sql.append(""zl as (select ZLZQDM as GZZQDM, ZLMKET as KMMKET, ZLJYJE as GZSZZE, ZLJYJE as GZCBZE from TGCORE.MON_ZL_WXSPVZL"")
                .append("" where ZLDATE=? and ZLCPDM=?),"");
        sql.append(""hz as (select GZZQDM,KMMKET, GZSZZE, GZCBZE from evl union all select GZZQDM,KMMKET, GZSZZE, GZCBZE from zl)"");
        sql.append(""select GZZQDM, KMMKET, GZSZZE, GZCBZE, ZQFXR, ZQNAME from hz left join (select * from TGCORE.MONSPV ""
                + ""where (ZQCODE,ZQCPDM) in (select ZQCODE,max(ZQCPDM) ZQCPDM from TGCORE.MONSPV where ZQCPDM=? or ZQCPDM=' ' group by ZQCODE)) ""
                + ""on ZQMKET =KMMKET and ZQCODE = GZZQDM where ZQZQLB='FBZQ' and ZQEJLB='SYPZ' and SFBJBZX='N' and trim(ZQFXR)=?"");
        Object[] args = new Object[]{prdCode, gzDate, subjectType, monDate, prdCode, prdCode, fxr};

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try{
            return jdbc.queryForList(sql.toString(), args);
        } catch (Exception e) {
            throw new MonitorBussException(""获取持仓的非保本型收益凭证"", e);
        }
    }"
"    public List<Map<String, Object>> getGptpgpNotExist(String cpdm, Date chdate, Date gzdate, String kmcplx) throws Exception {
        StringBuilder sbSql = new StringBuilder();
        sbSql.append("" with "");
        //股票信息
        sbSql.append("" gpxx as ( "");
        sbSql.append("" select GPMKET as MKET, GPCODE as ZQDM from tgcore.MONGP where GPDATE=? "");
        sbSql.append("" ), "");
        //估值表股票信息
        sbSql.append("" gzgp as ( "");
        sbSql.append("" select KMZQLS,KMMKET GZMKET, GZZHDM,GZZQDM,GZSZZE,GZGZSL from tgcore.EVLGZ,TGCORE.MONKM where GZKMDM=KMCODE and GZCPDM=? and GZDATE=? and KMCPLX=? and KMTYPE='CB' and KMZQLX='GP' and KMZQLS<>'KTTD' and ISFINAL='Y'"");
        sbSql.append("" ), "");
        //非公开发行股票
        sbSql.append("" fgkgp as ( "");
        sbSql.append("" select GZZHDM as ZHDM,GZZQDM as ZQDM,GZSZZE as SZ,GZGZSL as SL,GZMKET from gzgp "");
        sbSql.append("" where KMZQLS in ('DXZF','LTSX') "");
        sbSql.append("" ), "");
        //新股
        sbSql.append("" xg as ( "");
        sbSql.append("" select GZZHDM as ZHDM,GZZQDM as ZQDM,GZMKET from gzgp "");
        sbSql.append("" where KMZQLS='XG' "");
        sbSql.append("" ) "");
        //停牌股票对应的股票信息不存在
        sbSql.append("" select distinct GZZQDM as ZQDM,GZMKET as MKET from gzgp left join gpxx on GZZQDM=ZQDM and GZMKET=MKET "");
        sbSql.append("" where not exists (select 1 from fgkgp where GZZHDM=ZHDM) "");
        sbSql.append("" and not exists (select 1 from xg where GZZHDM=ZHDM) and ZQDM is null  "");


        return JdbcTemplate.getJdbcTemplate().queryForList(sbSql.toString(), chdate, cpdm, gzdate, kmcplx);
    }"
"    public List<Map<String, Object>> getStockHoldingByIndustry(String prdCode, Date date, String subjectType,
                                                               String stockIndexCode) throws MonitorBussException, MonitorSystException {
        String sql = ""with STKHOLD as (select GZZQDM,KMMKET, sum(GZSZZE) GZSZZE from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and "" +
                ""GZDATE=? and GZKMDM=KMCODE and KMCPLX=? and KMTYPE='CB' and KMZQLX='GP' and KMZQLS<>'FZ' group by GZZQDM,KMMKET)"" +
                ""select GZZQDM,KMMKET,GZSZZE,GPSWYJ,CITIC_ONELEVEL_TRADE,GPCODE from STKHOLD left join TGCORE.MONGP on GPDATE = ? and "" +
                ""KMMKET=GPMKET and GZZQDM=GPCODE"";
        try {
            Object[] args = new Object[]{prdCode, date, subjectType, date};
            return JdbcTemplate.getJdbcTemplate().queryForList(sql, args);
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓股票的市值以及申万一级行业和中信一级行业信息失败！"", e);
        }
    }"
"    public List<CCGPESGPJ.EsgStock> getStockEsgRate(MonObject monObject, Date busDate, Date esgDate, String zsCode)
            throws MonitorBussException, MonitorSystException {
        String sql = ""with gz as (select distinct KMMKET,GZZQDM from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? and KMCODE=GZKMDM and "" +
                ""KMCPLX=(select SUBJECT_TYPE from TGCORE.MON_PROD_SUBJECT where PRD_TYPE = ? AND ? between START_DATE and END_DATE AND rownum=1) and "" +
                ""KMTYPE ='CB' and KMZQLX='GP' and ISFINAL='Y' and KMZQLS not in ('FZ','XG')) "" +
                ""select GZZQDM,KMMKET,NAME,ESG_RATE from gz left join TGCORE.MONGP_ESG on GZZQDM=CODE and KMMKET=MARKET and UPLOAD_DATE=? "";
        List<Object> paramList = new ArrayList<>(Arrays.asList(monObject.getValue(), busDate, monObject.getPrdType(), busDate, esgDate));
        if (!StringUtil.isNullOrEmpty(zsCode)) {
            sql += ""and not exists (select 1 from TGCORE.MONZS where ZSZQDM=GZZQDM and ZSMKET=KMMKET and ZSDATE=? and ZSZSLB=?)"";
            paramList.addAll(Arrays.asList(busDate, zsCode));
        }
        try {
            return JdbcTemplate.getJdbcTemplate().queryForList(sql, paramList, (rs, n) -> new CCGPESGPJ.EsgStock(rs.getString(""GZZQDM""), rs.getString(""KMMKET""), rs.getString(""NAME""), rs.getString(""ESG_RATE"")));
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓股票ESG评级失败:"" + e.getMessage(), e);
        }
    }"
"    public BigDecimal getIndexStockHolding(String prdCode, Date date, String subjectType,
                                           String stockIndexCode) throws MonitorBussException, MonitorSystException {
        String sql = ""with STKHOLD as (select GZZQDM,KMMKET,GZSZZE from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and "" +
                ""GZDATE=? and GZKMDM=KMCODE and KMCPLX=? and KMTYPE='CB' and KMZQLX in ('GP','ZQ','ZCZQ') and KMZQLS<>'FZ' ) "" +
                ""select NVL(sum(GZSZZE),0) SZ from STKHOLD,TGCORE.MONZS where GZZQDM = ZSZQDM and KMMKET = ZSMKET and "" +
                ""ZSZSLB = ? and ZSDATE = ?"";
        try {
            Object[] args = new Object[]{prdCode, date, subjectType, stockIndexCode, date};
            BigDecimal je = JdbcTemplate.getJdbcTemplate().queryForObject(sql, args, new RowMapper<BigDecimal>() {
                @Override
                public BigDecimal mapRow(ResultSet rs, int rowCount) throws Exception {
                    return rs.getBigDecimal(""SZ"");
                }
            });

            return je;
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓指数成分股信息失败！"", e);
        }
    }"
"    public BigDecimal getHqAndBzj(String prdCode, Date date, String subjectType) throws MonitorBussException, MonitorSystException {
        String sql = ""select NVL(sum(GZSZZE),0) SZ from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? and "" +
                ""GZZHDM=KMCODE and KMCPLX=? and ((KMTYPE in (' ','CB') and KMZQLX='CK' and KMZQLS='HQ') or ("" +
                ""KMZQLX in ('BZJ') and KMZQLS = 'SFCGBZJ'))"";
        try {
            Object[] args = new Object[]{prdCode, date, subjectType};
            BigDecimal je = JdbcTemplate.getJdbcTemplate().queryForObject(sql, args, new RowMapper<BigDecimal>() {
                @Override
                public BigDecimal mapRow(ResultSet rs, int rowCount) throws Exception {
                    return rs.getBigDecimal(""SZ"");
                }
            });

            return je;
        } catch (Exception e) {
            throw new MonitorSystException(""获取活期和三方存管保证金失败！"", e);
        }
    }"
"    public List<Map<String, Object>> getStockHolding(String prdCode, java.util.Date date, String subjectType) throws MonitorSystException {
        String sql = ""with STK as (""
                + ""select GZZQDM, KMMKET, GZSZZE, GZCBZE from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and ""
                + ""GZDATE=? and GZKMDM=KMCODE and KMCPLX=? and KMTYPE in ('CB','YZ') and KMZQLX='GP' and KMZQLS<>'FZ' and ISFINAL = 'Y' ""
                + ""), ""
                + ""GP AS (SELECT GPCODE, GPNAME, GPDATE, GPMKET FROM TGCORE.MONGP WHERE GPDATE = ?) ""
                + ""select GZZQDM, KMMKET, GZSZZE, GZCBZE, GPCODE SECCODE, GPNAME SECNAME, 'GP' SECTYPE from STK left join GP ""
                + ""on KMMKET=GPMKET and GZZQDM=GPCODE "";
        try {
            Object[] args = new Object[]{prdCode, date, subjectType, date};
            return JdbcTemplate.getJdbcTemplate().queryForList(sql, args);
        } catch (Exception e) {
            throw new MonitorSystException(""获取股票持仓失败！"", e);
        }
    }"
"    public HashMap<String, EvaluationEntity> loadEvaluation(Date evlDate, String cpdm, boolean isBxQd) throws Exception {
        HashMap<String, EvaluationEntity> gzbes = new HashMap<>(256);

        String sSql = """";
        if (!isBxQd) {
            sSql = ""select GZZHDM,GZCBZE,GZSZZE,GZCBBL,GZSZBL,GZGZSL,GZZHMC ""
                    + ""from TGCORE.EVLGZ where GZCPDM =? and GZDATE=? and gzzhdm like '9999%'"";
        } else {
            sSql =
                    "" SELECT  ACCCODE GZZHDM, ACCNAME GZZHMC,  ORIGCRCY, STADCOST GZCBZE, STADVAL GZSZZE, EVLQTY GZGZSL ,  COSTRATIO GZCBBL, VALRATIO GZSZBL""
                            +
                            "" FROM TGCORE.EVALUATION where PRDCODE = ? and BIZDATE =? and  ACCCODE like '9999%'"";
        }

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        jdbcTemplate.query(sSql, new Object[]{cpdm, evlDate}, new RowCallbackHandler() {
            @Override
            public void processRow(ResultSet rs, int rowIndex) throws Exception {
                String strZHDM = rs.getString(""GZZHDM"").trim();

                EvaluationEntity gzbEntry = new EvaluationEntity();
                gzbEntry.set_cbze(rs.getBigDecimal(""GZCBZE""));
                gzbEntry.set_szze(rs.getBigDecimal(""GZSZZE""));
                gzbEntry.set_cbbl(Calc.div(rs.getBigDecimal(""GZCBBL""), 100));
                gzbEntry.set_szbl(Calc.div(rs.getBigDecimal(""GZSZBL""), 100));
                gzbEntry.set_gzsl(rs.getBigDecimal(""GZGZSL""));
                gzbEntry.set_zhmc(rs.getString(""GZZHMC"").trim());

                gzbes.put(strZHDM, gzbEntry);
            }
        });

        return gzbes;

    }"
"    public Map<String, String> getSumByPrdCodeInPlan(Date evlDate, String prdCode) throws Exception {

        //先查询当前产品计划下的所有产品，再根据查出的产品从EVLGZ中查询资产净值
        String sql =
                "" WITH cp AS (SELECT CPCODE  FROM TGCORE.MONPR m WHERE CPSCLS <> 'STH' AND CPJHDM IN (SELECT CPJHDM FROM TGCORE.MONPR  WHERE CPCODE  = ? )) , ""
                        +
                        "" gzcp AS (SELECT * FROM TGCORE.EVLGZ e WHERE GZDATE = ? AND  GZZHDM='99990004' AND GZCPDM IN (SELECT DISTINCT CPCODE FROM cp)) ""
                        +
                        "" SELECT SUM(GZSZZE) AS GZSZZE,SUM(GZCBZE) AS GZCBZE  FROM gzcp "";

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        Object[] args = {prdCode, evlDate};

        return jdbcTemplate.queryForObject(sql, args, (rs, rowNum) -> {
            Map<String, String> res = new HashMap<>();
            res.put(""GZSZZE"", rs.getBigDecimal(""GZSZZE"").toString());
            res.put(""GZCBZE"", rs.getBigDecimal(""GZCBZE"").toString());
            return res;
        });
    }"
"    public List<Map<String, String>> getSumGroupByManager(Date evlDate, String prdCode, String sumType) throws Exception {

        //先查询当前产品计划下的所有产品，再从EVLGZ中查询市值总额和成本总额，并根据管理人分组后就资产净值的和
        String sql =
                "" WITH cp AS (SELECT CPCODE,CPMNAM  FROM TGCORE.MONPR m WHERE CPSCLS <> 'STH' AND CPJHDM IN (SELECT CPJHDM FROM TGCORE.MONPR  WHERE CPCODE  = ? )) , ""
                        +
                        "" gzcp AS (SELECT e.*,cp.CPMNAM FROM TGCORE.EVLGZ e INNER JOIN cp ON e.GZCPDM = cp.CPCODE  WHERE GZZHDM='99990004' AND e.GZDATE = ? )  ""
                        +
                        "" SELECT CPMNAM,sum(GZSZZE) AS GZSZZE ,sum(GZCBZE) AS GZCBZE FROM gzcp GROUP BY CPMNAM "";
        if (""SZZE"".equals(sumType)) {
            sql = sql + ""ORDER BY GZSZZE desc"";
        }
        if (""CBZE"".equals(sumType)) {
            sql = sql + ""ORDER BY GZCBZE desc"";
        }

        JdbcTemplate jdbcTemplate = JdbcTemplate.getJdbcTemplate();
        Object[] args = {prdCode, evlDate};

        return jdbcTemplate.queryForList(sql, args, (rs, rowIndex) -> {

            Map<String, String> map = new HashMap<>();
            map.put(""CPMNAM"", rs.getString(""CPMNAM"").trim());
            map.put(""GZSZZE"", rs.getString(""GZSZZE"").trim());
            map.put(""GZCBZE"", rs.getString(""GZCBZE"").trim());
            return map;
        });
    }"
"    public List<Map<String, Object>> getAllHolding(String prdCode, java.util.Date bizdate,
                                                   String subjectType, String isPenetrate) throws MonitorSystException {
        StringBuilder sql = new StringBuilder(256);
        String evlTableName = ""tgcore.EVLGZ"";
        //支持穿透
        if (MonConstants.Y_N_FLAG_Y.equals(isPenetrate)) {
            evlTableName = ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", new Date(bizdate.getTime()));
        }
        sql.append(""with GZ as (select NVL(GZZHDM,' ') as GZZHDM, NVL(GZZHMC,' ') as GZZHMC, NVL(GZKMDM, ' ') as GZKMDM, ""
                        + ""NVL(GZZQDM,' ') as GZZQDM from "")
                .append(evlTableName);
        sql.append("" where GZCPDM=? and GZDATE=? and (GZZHDM not like '9999%' and GZZHDM not like '6%' and GZZHDM not like '4%')),"");
        sql.append(""GZKM as (select GZZHDM,GZZHMC,GZKMDM,GZZQDM,KMNAME,KMCODE,KMMKET, ""
                + ""(case when KMZQLX in ('BFJ','BZJ','GP') and KMZQLS='RZRQ' then KMZQLS ""
                + ""when GZZHDM like '2202%' then 'ZHG' else KMZQLX end ) KMZQLX,""
                + ""KMZQLS,KMTYPE,KMLEVL,ISFINAL from GZ,TGCORE.MONKM where KMCPLX=? and (KMCODE=GZZHDM or KMCODE=GZKMDM) ""
                + ""and KMZQLX not in ('ZQ','JJ','SPQQ')"");
        sql.append(""union all "");
        sql.append(""select GZZHDM,GZZHMC,GZKMDM,GZZQDM,KMNAME,KMCODE,KMMKET,KMZQLX,KMZQLS,KMTYPE,KMLEVL,ISFINAL from GZ,TGCORE.MONKM ""
                + ""where KMCPLX=? and KMCODE=GZKMDM and KMZQLX in ('ZQ','JJ','SPQQ') and ISFINAL='Y' ),"");
        sql.append(""ZQ as (select ZQCODE,ZQMKET,ZQZQLB,ZQYXZQ from tgcore.MONZQ where ZQDATE=? and ZQSYFW='P'), "");
        sql.append(""JJ AS (SELECT JJCODE ,JJMKET ,JJTYPE  FROM tgcore.MONJJ m WHERE JJDATE =?  )"");
        sql.append(""select GZZHDM,GZZHMC, GZKMDM, GZZQDM, KMNAME,KMCODE,KMMKET, KMZQLX, KMZQLS, KMTYPE,KMLEVL,ISFINAL,  ""
                        + ""NVL(ZQZQLB,' ') as ZQZQLB,NVL(ZQYXZQ,' ') as ZQYXZQ ,NVL(JJTYPE,' ') as JJTYPE "")
                .append(""from GZKM left join ZQ ON  KMZQLX ='ZQ'  and ZQCODE=GZZQDM and ZQMKET = KMMKET LEFT JOIN JJ ""
                        + ""ON KMZQLX ='JJ' AND GZZQDM = JJCODE AND KMMKET = JJMKET"");
        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        Object[] args = new Object[]{prdCode, bizdate, subjectType, subjectType, bizdate, bizdate};
        try {
            return jdbc.queryForList(sql.toString(), args).stream().sorted(Comparator.comparing(e -> e.get(""GZZHDM"").toString()))
                    .collect(Collectors.toList());
        } catch (Exception e) {
            throw new MonitorSystException(""获取当前产品的持仓失败:"", e);
        }
    }"
"    private void suretySQL(final StringBuilder sql, final String prdCode, final String subjectType) {
        sql.append("" select GZSZZE as JE,TRUNC(TO_NUMBER(0)) as SYQX,'EVLGZ' as SJLY,KMZQLX as KMZQLX,GZZQDM as SECCODE from TGCORE.EVLGZ, TGCORE.MONKM "");
        sql.append("" where GZCPDM= '"").append(prdCode).append(""' and GZDATE=? and KMCODE=GZZHDM "");
        sql.append("" and KMCPLX='"").append(subjectType).append(""' "");
        sql.append("" and ((KMZQLX='CK' and KMZQLS='HQ' and KMTYPE in (' ','CB') and ISFINAL='Y') or (KMZCLEVL='1' and KMZQLX in ('BFJ','BZJ') and KMTYPE in (' ','CB')))"");
    }"
"    private void liquidationSQL(final StringBuilder sql, final String prdCode, final String subjectType) {
        sql.append("" select GZSZZE as JE,TRUNC(TO_NUMBER(1)) as SYQX,'EVLGZ' as SJLY,KMZQLX as KMZQLX,GZZQDM as SECCODE from TGCORE.EVLGZ,TGCORE.MONKM "");
        sql.append("" where GZCPDM= '"").append(prdCode).append(""' and GZDATE=? and KMCODE=GZZHDM "");
        sql.append("" and KMCPLX='"").append(subjectType).append(""' "");
        sql.append("" and KMZCLEVL='2' and KMZQLX= 'QSK' and KMTYPE in (' ','CB') "");
    }"
"    private void currencyFundSQL(final StringBuilder sql, final String kmType, final Date monDate, final String prdCode, final String subjectType, final boolean existPenetrate) {
        sql.append("" with  km as(  select CASE KMCPLX WHEN 'BX' THEN (CASE KMMKET WHEN 'G' THEN 'X' ELSE KMMKET END) ELSE KMMKET END AS KMMKET, "");
        sql.append("" KMCPLX,KMCODE ,KMZQLX,KMZQLS,KMTZFL,KMTYPE from TGCORE.MONKM where "");
        sql.append("" KMCPLX='"").append(subjectType).append(""' "");
        if (""QJ"".equals(kmType)) {// 全价
            sql.append("" and KMTYPE in ("" + ZbConstants.KM_TYPE_QJ + "") "");
        } else {// 净价
            sql.append("" and KMTYPE in ("" + ZbConstants.KM_TYPE_JJ + "") "");
        }
        sql.append("" and ISFINAL='Y'  and KMZQLX in ('JJ') and KMZQLS <> 'FZ' ), "");
        sql.append("" kmgz as (select GZCPDM,GZDATE,GZZHDM,GZZQDM,GZZHMC,GZSZZE,GZKMDM,KMZQLX,KMZQLS,KMTYPE,KMMKET,KMCPLX  from "");
        if (existPenetrate) {//是否穿透
            sql.append(ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", monDate) + "" gz,km "");
        } else {
            sql.append("" TGCORE.EVLGZ gz,km "");
        }
        sql.append("" where GZDATE = ? and  GZKMDM=KMCODE  AND  GZCPDM= ?  ), "");
        sql.append("" ccjj as( select * from kmgz inner join (select JJ.* from  TGCORE.MONJJ JJ where  JJDATE = ? and JJTYPE = 'HBX'  )  "");
        sql.append("" on JJCODE = GZZQDM and JJMKET = KMMKET )  "");
        sql.append("" select GZZQDM as SECCODE,JJNAME as SECNAME,JJMKET as JJMKET,GZSZZE as JE,'1' as SYQX from ccjj "");
    }"
"    private void depositsSQL(final StringBuilder sql, final String kmType, final Date monDate, final String prdCode, final String subjectType, final boolean existPenetrate) {
        sql.append("" with   km as ( select CASE KMCPLX WHEN 'BX' THEN (CASE KMMKET WHEN 'G' THEN 'X' ELSE KMMKET END) ELSE KMMKET END AS KMMKET,"" +
                "" KMCPLX,KMCODE ,KMZQLX,kmzqls,SECTYPE3,KMTZFL,KMTYPE from TGCORE.MONKM where "");
        sql.append("" KMCPLX='"").append(subjectType).append(""' "");
        if (""QJ"".equals(kmType)) {// 全价
            sql.append("" and KMTYPE in ("" + ZbConstants.KM_TYPE_QJ + "") "");
        } else {// 净价
            sql.append("" and KMTYPE in ("" + ZbConstants.KM_TYPE_JJ + "") "");
        }
        sql.append("" and ISFINAL='Y'  and KMZQLX in ('CK') and KMZQLS <> 'FZ' ),  "");
        sql.append("" kmgz as (select GZCPDM,GZDATE,GZZHDM,GZZQDM,gzzhmc,KMZQLX,kmzqls,SECTYPE3,KMTYPE,gzszze,gzgzsl,"" +
                "" gzszbl,KMMKET,KMCPLX,GZKMDM ,KMMKET||GZZQDM as GZSCZQDM, GZDWCB,GZGZJG,  GZGZZZ, GZZZBL, GZGZFF, GZZZKM, GZQYXX, GZBZXX,KMTZFL from "");
        if (existPenetrate) {//是否穿透
            sql.append(ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", monDate) + "" gz,km "");
        } else {
            sql.append("" TGCORE.EVLGZ gz,km "");
        }
        sql.append(""  where GZDATE=?  and  GZKMDM=KMCODE  AND  GZCPDM=?  ), "");
        sql.append("" dq as( SELECT  *  FROM TGCORE.EVLDQ  dqsj where dqcpdm = ?  and  dqstrd <= ? and "" +
                "" dqendd > ? and dqstat = 'A' ), "");
        sql.append("" lx as( select gzzhdm as  lxzhdm ,gzcbze as gzlxje from "");
        if (existPenetrate) {//是否穿透
            sql.append(ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", monDate) + "", "");
        } else {
            sql.append("" TGCORE.EVLGZ, "");
        }
        sql.append("" TGCORE.MONKM where KMCODE=GZKMDM and gzcpdm = ? and  gzdate = ? "");
        sql.append("" and KMCPLX='"").append(subjectType).append(""' "");
        sql.append("" and kmtype IN ('LX','YJLX') and KMZQLX <>'YF' and KMZQLS<>'TYCR' and ISFINAL ='Y' ), "");
        sql.append("" ck as( SELECT a.*,a.dqcjbh as cjbh , gzszze+NVL(gzlxje,0) as gzszqj,a.DQCKYH as ISSUER FROM "" +
                "" (select GZCPDM,GZZHDM,GZZQDM,kmzqls AS CKLX,gzszze,gzgzsl,gzszbl,KMMKET,KMCPLX,GZKMDM,dq.*, "" +
                "" (dqendd-dqstrd) as ckckqx from kmgz,dq where gzzhdm=DQDQZH) a "" +
                "" left join lx on lx.lxzhdm = a.dqjfzh ) "");
        sql.append("" select CJBH as CJBH,DQENDD as DQENDD,GZSZZE as JE,DQCKLX as DQCKLX,DQTZTS as DQTZTS from ck "");
    }"
"    private void spvSQL(final StringBuilder sql, final String kmType, final Date monDate, final String prdCode, final String subjectType, final boolean existPenetrate) {
        sql.append(""with   km as(  select CASE KMCPLX WHEN 'BX' THEN (CASE KMMKET WHEN 'G' THEN 'X' ELSE KMMKET END) ELSE KMMKET END AS KMMKET,"" +
                ""KMCPLX,KMCODE ,KMZQLX,kmzqls,SECTYPE3,KMTZFL,KMTYPE from TGCORE.MONKM where "");
        sql.append("" KMCPLX='"").append(subjectType).append(""' "");
        if (""QJ"".equals(kmType)) {// 全价
            sql.append("" and KMTYPE in ("" + ZbConstants.KM_TYPE_QJ + "") "");
        } else {// 净价
            sql.append("" and KMTYPE in ("" + ZbConstants.KM_TYPE_JJ + "") "");
        }
        sql.append("" and ISFINAL='Y'  and KMZQLX in ('SPV') and KMZQLS <> 'FZ' ),  "");

        sql.append("" kmgz as (select GZCPDM,GZDATE,GZZHDM,GZZQDM,gzzhmc,KMZQLX,kmzqls,SECTYPE3,KMTYPE,gzszze,gzgzsl,gzszbl,KMMKET,KMCPLX,GZKMDM ,"" +
                ""KMMKET||GZZQDM as GZSCZQDM, GZDWCB,GZGZJG,  GZGZZZ, GZZZBL, GZGZFF, GZZZKM, GZQYXX, GZBZXX,KMTZFL from "");
        if (existPenetrate) {
            sql.append(ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", monDate) + "" gz,km "");
        } else {
            sql.append(""TGCORE.EVLGZ gz,km "");
        }
        sql.append("" where GZDATE=?  and  GZKMDM=KMCODE  AND  GZCPDM=?  ),"");

        sql.append("" spvtz as( SELECT ccspv.* , FBCODE,FBMKET,FBZQLB,FBEJLB, FBSJLB, FB4JLB, FBFLWD, FBFXRN,FBNAME,FBENDD,FBISFBZC,FBTZXZ,FBZCLX FROM kmgz ccspv "" +
                "" inner join ( select * from  (select * from TGCORE.MONFB where FBSTAT = 'A' and FBCPDM =?  ) monfb_cp_1 union "" +
                "" select * from TGCORE.MONFB where FBSTAT = 'A' and trim(FBCPDM) IS NULL and  not exists  "" +
                "" (select 1 from (select * from TGCORE.MONFB where FBSTAT = 'A' and FBCPDM =? ) monfb_cp_2  where monfb_cp_2.FBCODE = TGCORE.MONFB.FBCODE and monfb_cp_2.FBMKET = TGCORE.MONFB.FBMKET)  ) monfb_tmp  "" +
                "" on fbmket =kmmket  and fbcode = gzzqdm where  FBSTAT = 'A')  "" +
                "" select FBCODE as SECCODE,FBNAME as SECNAME,FBMKET as FBMKET,GZSZZE as JE,TRUNC(TO_NUMBER(FBENDD-TO_DATE('"");
        sql.append(monDate.toString()).append(""','yyyy-mm-dd'))) as SYQX from spvtz"");
    }"
"    public List<Map<String, Object>> getFundAndPensionsPositions() throws MonitorBussException {
        String sql = ""with GZ as (select GZZHDM,GZZQDM,KMMKET,GZSZZE,KMZQLX,GZZHMC from TGCORE.EVLGZ, TGCORE.MONKM where GZKMDM = KMCODE "" +
                ""and GZCPDM = ? and GZDATE = ? and KMCPLX = ? and KMZQLX in ('JJ','YL') and KMTYPE = 'CB' and ISFINAL = 'Y') "" +
                ""select GZZHDM,GZZQDM,KMMKET,GZSZZE SZ,JJSILB,KMZQLX,GZZHMC,NVL(SHRZJDZR_DAYS, 0) SYQX from GZ left join TGCORE.MONJJ "" +
                ""on GZZQDM = JJCODE and KMMKET = JJMKET and JJDATE = ?"";

        Object[] args = {prdCode, monDate, subjectType, monDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        try {
            return jdbcTemplate.queryForList(sql.toString(), args);
        } catch (Exception e) {
            throw new MonitorBussException(e.getMessage(), e);
        }
    }"
"    public List<Map<String, Object>> getBondPositions() throws MonitorBussException {
        String sql = ""with cczq as ( "" +
                ""select GZZQDM,GZSZZE,NVL(KSMKET,' ') as MKET from TGCORE.EVLGZ, TGCORE.MONKMSC "" +
                ""where GZCPDM = ? and GZDATE = ? and substr(GZZHDM,1,6) = KSCODE and KSKMLB = 'SI' and (GZZHDM like '1112__01_%' "" +
                ""or GZZHDM like '1132__01_%' or GZZHDM like '1133__01_%' or GZZHDM like '1111__01_%' or GZZHDM like '1103__01_%' "" +
                ""or GZZHDM like '1104__01_%' or GZZHDM like '11070101_%' )), "" +
                ""sumzq as (select GZZQDM,MKET,NVL(sum(GZSZZE), 0) as SZ from cczq group by GZZQDM,MKET ) "" +
                ""select GZZQDM,MKET,SZ,ZQCODE,ZQSTRD,ZQENDD,ZQLVLX,ZQQLTK,ZQHSRQ,ZQSYQX SYQX,NVL(ZQNAME,'') ZQNAME from sumzq left join "" +
                ""TGCORE.MONZQ on ZQDATE = ? and ZQCODE = GZZQDM and ZQMKET = MKET and ZQSYFW = 'P' and ZQENDD >= ?"";

        Object[] args = {prdCode, monDate, monDate, monDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        try {
            return jdbcTemplate.queryForList(sql.toString(), args);
        } catch (Exception e) {
            throw new MonitorBussException(e.getMessage(), e);
        }
    }"
"    public BigDecimal getCurrentDepositPositions() throws MonitorBussException {
        String sql = ""select NVL(sum(gzszze),0) as SZ from TGCORE.EVLGZ where GZCPDM = ? and GZDATE = ? and GZZHDM = '100201'"";

        Object[] args = {prdCode, monDate};
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        try {
            return jdbcTemplate.queryForObject(sql.toString(), args, new RowMapper<BigDecimal>() {
                @Override
                public BigDecimal mapRow(ResultSet rs, int rowNum) throws Exception {
                    return rs.getBigDecimal(""SZ"");
                }
            });
        } catch (Exception e) {
            throw new MonitorBussException(e.getMessage(), e);
        }
    }"
"    public List<BondGlfEntity> getHoldBonds(Date busDate, Date chDate, String prdCode, String subjectPrdType, String prdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        Object[] params;
        if (ZbConstants.CPLX_BX.equals(prdType) || ZbConstants.CPLX_QD.equals(prdType)) {
            sbSql.append(""with gz as ( "");
            sbSql.append(""select BIZDATE GZDATE, PRDCODE GZCPDM, KMMKET GZMKET, SECCODE GZZQDM, KMZQLX, SUM(STADCOST) GZCBZE, SUM(STADVAL) GZSZZE "");
            sbSql.append(""from tgcore.evaluation,tgcore.monkm "");
            sbSql.append(""where BIZDATE=? and PRDCODE=? and kmcplx=? and coacode=kmcode "");
            sbSql.append(""AND KMZQLX in ('ZQ','ZCZQ') and kmtype in ('CB','YZ','JZZB01','JZZB02','JZZB03','LX','YJLX') "");
            sbSql.append(""AND ISFINAL='Y' and KMZQLS <> 'FZ' and KMKMBZ = 'CNY' and KMBZXX <> 'OVERSEA' "");
            sbSql.append(""GROUP BY BIZDATE, PRDCODE, KMMKET, SECCODE, KMZQLX), "");
            sbSql.append(""ZqResult AS ( "");
            sbSql.append(""select gz.*, NVL(ZQNAME,' ') AS ZQNAME, "");
            // 如果是资产债券则取原始权益人
            sbSql.append(""NVL(case KMZQLX when 'ZCZQ' then ZQYSQY else ZQFXRN end, ' ') AS ZQFXRN "");
            sbSql.append(""FROM gz "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = ? and zqmket = GZMKET and zqcode = GZZQDM  "");
            sbSql.append(""and zqstat = 'A' and ZQSYFW='P' "");
            sbSql.append("") "");
            sbSql.append(""SELECT * FROM ZqResult "");

        } else {
            sbSql.append(""WITH cczq as( "");
            sbSql.append(""select GZDATE, GZCPDM, KMMKET AS GZMKET, GZZQDM, KMZQLX, SUM(GZCBZE) AS GZCBZE, SUM(GZSZZE) AS GZSZZE "");
            sbSql.append(""from TGCORE.EVLGZ,TGCORE.MONKM "");
            sbSql.append(""where GZDATE=? and GZCPDM=? and KMCPLX=? and KMCODE=GZKMDM "");
            sbSql.append(""and KMZQLX in ('ZQ','ZCZQ') and KMTYPE in ('CB','YZ','JZZB01','JZZB02','JZZB03','LX','YJLX') "");
            sbSql.append(""and ISFINAL='Y' and KMZQLS <> 'FZ' "");
            sbSql.append(""GROUP BY GZDATE, GZCPDM, KMMKET, GZZQDM, KMZQLX) "");
            sbSql.append(""select cczq.*, NVL(ZQNAME,' ') ZQNAME, "");
            // 如果是资产债券则取原始权益人
            sbSql.append(""NVL(case KMZQLX when 'ZCZQ' then ZQYSQY else ZQFXRN end,' ') ZQFXRN "");
            sbSql.append(""FROM cczq "");
            sbSql.append(""LEFT JOIN TGCORE.MONZQ ON zqdate = ? and zqmket = GZMKET and zqcode = GZZQDM "");
            sbSql.append(""and zqstat = 'A' and ZQSYFW='P' "");
        }
        params = new Object[]{busDate, prdCode, subjectPrdType, chDate};

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), params, new RowMapper<BondGlfEntity>() {
                @Override
                public BondGlfEntity mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondGlfEntity res = new BondGlfEntity();
                    // 该属性临时存放标的类型
                    res.setZqKey(""债券"");
                    res.setGzDate(rs.getDate(""GZDATE""));
                    res.setGzCpdm(rs.getString(""GZCPDM""));
                    res.setGzMket(rs.getString(""GZMKET""));
                    res.setGzZqdm(rs.getString(""GZZQDM""));
                    res.setGzCbze(rs.getBigDecimal(""GZCBZE""));
                    res.setGzSzze(rs.getBigDecimal(""GZSZZE""));
                    res.setZqName(rs.getString(""ZQNAME""));
                    res.setZqFxrn(rs.getString(""ZQFXRN""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓债券失败"", e);
        }
    }"
"    public List<BondGlfEntity> getHoldFunds(Date busDate, Date chDate, String prdCode, String subjectPrdType, String prdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        Object[] params;
        if (ZbConstants.CPLX_BX.equals(prdType) || ZbConstants.CPLX_QD.equals(prdType)) {
            sbSql.append(""with gz as ( "");
            sbSql.append(""select BIZDATE GZDATE, PRDCODE GZCPDM, KMMKET GZMKET, SECCODE GZZQDM, SUM(STADCOST) GZCBZE, SUM(STADVAL) GZSZZE "");
            sbSql.append(""from tgcore.evaluation, tgcore.monkm "");
            sbSql.append(""where BIZDATE=? and PRDCODE=? and kmcplx=? and coacode=kmcode "");
            sbSql.append(""AND KMZQLX in ('JJ') and kmtype in ('CB') and ISFINAL='Y' and KMZQLS <> 'FZ' and KMKMBZ = 'CNY' and KMBZXX <> 'OVERSEA' "");
            sbSql.append(""GROUP BY BIZDATE, PRDCODE, KMMKET, SECCODE), "");
            sbSql.append(""jjResult AS ( "");
            sbSql.append(""select gz.*, NVL(JJNAME,' ') AS JJNAME, "");
            sbSql.append(""NVL(JJGLRN, ' ') AS JJGLRN "");
            sbSql.append(""FROM gz "");
            sbSql.append(""LEFT JOIN TGCORE.MONJJ ON jjdate = ? and jjmket = GZMKET and jjcode = GZZQDM  "");
            sbSql.append("") "");
            sbSql.append(""SELECT * FROM jjResult "");

        } else {
            sbSql.append(""WITH ccjj as( "");
            sbSql.append(""select GZDATE, GZCPDM, KMMKET AS GZMKET, GZZQDM, SUM(GZCBZE) AS GZCBZE, SUM(GZSZZE) AS GZSZZE "");
            sbSql.append(""from TGCORE.EVLGZ,TGCORE.MONKM "");
            sbSql.append(""where GZDATE=? and GZCPDM=? and KMCPLX=? and KMCODE=GZKMDM "");
            sbSql.append(""and KMZQLX in ('JJ') and KMTYPE in ('CB') and ISFINAL='Y' and KMZQLS <> 'FZ' "");
            sbSql.append(""GROUP BY GZDATE, GZCPDM, KMMKET, GZZQDM) "");
            sbSql.append(""select ccjj.*, NVL(JJNAME,' ') JJNAME, "");
            sbSql.append(""NVL(JJGLRN,' ') JJGLRN "");
            sbSql.append(""FROM ccjj "");
            sbSql.append(""LEFT JOIN TGCORE.MONJJ ON jjdate = ? and jjmket = GZMKET and jjcode = GZZQDM "");
        }
        params = new Object[]{busDate, prdCode, subjectPrdType, chDate};

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), params, new RowMapper<BondGlfEntity>() {
                @Override
                public BondGlfEntity mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondGlfEntity res = new BondGlfEntity();
                    // 该属性临时存放标的类型
                    res.setZqKey(""基金"");
                    res.setGzDate(rs.getDate(""GZDATE""));
                    res.setGzCpdm(rs.getString(""GZCPDM""));
                    res.setGzMket(rs.getString(""GZMKET""));
                    res.setGzZqdm(rs.getString(""GZZQDM""));
                    res.setGzCbze(rs.getBigDecimal(""GZCBZE""));
                    res.setGzSzze(rs.getBigDecimal(""GZSZZE""));
                    // 基金名称，暂存债券名称字段
                    res.setZqName(rs.getString(""JJNAME""));
                    res.setZqFxrn(rs.getString(""JJGLRN""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓基金失败"", e);
        }
    }"
"    public List<BondGlfEntity> getHoldStocks(Date busDate, Date chDate, String prdCode, String subjectPrdType, String prdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        Object[] params;
        if (ZbConstants.CPLX_BX.equals(prdType) || ZbConstants.CPLX_QD.equals(prdType)) {
            sbSql.append(""with gz as ( "");
            sbSql.append(""select BIZDATE GZDATE, PRDCODE GZCPDM, SECCODE GZZQDM, SUM(STADCOST) GZCBZE, SUM(STADVAL) GZSZZE, "");
            sbSql.append(""CASE KMCPLX WHEN 'BX' THEN (CASE KMMKET WHEN 'G' THEN 'X' ELSE KMMKET END) ELSE KMMKET END AS GZMKET "");
            sbSql.append(""from tgcore.evaluation,tgcore.monkm "");
            sbSql.append(""where BIZDATE=? and PRDCODE=? and kmcplx=? and coacode=kmcode "");
            sbSql.append(""AND KMZQLX in ('GP') and kmtype in ('CB') and ISFINAL='Y' and KMZQLS <> 'FZ' and KMKMBZ = 'CNY' and KMBZXX <> 'OVERSEA' "");
            sbSql.append(
                    ""GROUP BY BIZDATE, PRDCODE, CASE KMCPLX WHEN 'BX' THEN (CASE KMMKET WHEN 'G' THEN 'X' ELSE KMMKET END) ELSE KMMKET END, SECCODE), "");
            sbSql.append(""GpResult AS ( "");
            sbSql.append(""select gz.*, NVL(GPNAME,' ') AS GPNAME, "");
            sbSql.append(""NVL(GPQFXR, ' ') AS GPQFXR "");
            sbSql.append(""FROM gz "");
            sbSql.append(""LEFT JOIN TGCORE.mongp ON GPDATE = ? and GPMKET = GZMKET and GPCODE = GZZQDM  "");
            sbSql.append("") "");
            sbSql.append(""SELECT * FROM GpResult "");

        } else {
            sbSql.append(""WITH ccgp as( "");
            sbSql.append(""select GZDATE, GZCPDM, KMMKET AS GZMKET, GZZQDM, SUM(GZCBZE) AS GZCBZE, SUM(GZSZZE) AS GZSZZE "");
            sbSql.append(""from TGCORE.EVLGZ,TGCORE.MONKM "");
            sbSql.append(""where GZDATE=? and GZCPDM=? and KMCPLX=? and KMCODE=GZKMDM "");
            sbSql.append(""and KMZQLX in ('GP') and KMTYPE in ('CB') and ISFINAL='Y' and KMZQLS <> 'FZ' "");
            sbSql.append(""GROUP BY GZDATE, GZCPDM, KMMKET, GZZQDM) "");
            sbSql.append(""select ccgp.*, NVL(GPNAME,' ') GPNAME, "");
            sbSql.append(""NVL(GPQFXR,' ') GPQFXR "");
            sbSql.append(""FROM ccgp "");
            sbSql.append(""LEFT JOIN TGCORE.mongp ON GPDATE = ? and GPMKET = GZMKET and GPCODE = GZZQDM "");
        }
        params = new Object[]{busDate, prdCode, subjectPrdType, chDate};

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), params, new RowMapper<BondGlfEntity>() {
                @Override
                public BondGlfEntity mapRow(ResultSet rs, int rowNum) throws Exception {
                    BondGlfEntity res = new BondGlfEntity();
                    // 该属性临时存放标的类型
                    res.setZqKey(""股票"");
                    res.setGzDate(rs.getDate(""GZDATE""));
                    res.setGzCpdm(rs.getString(""GZCPDM""));
                    res.setGzMket(rs.getString(""GZMKET""));
                    res.setGzZqdm(rs.getString(""GZZQDM""));
                    res.setGzCbze(rs.getBigDecimal(""GZCBZE""));
                    res.setGzSzze(rs.getBigDecimal(""GZSZZE""));
                    res.setZqName(rs.getString(""GPNAME""));
                    res.setZqFxrn(rs.getString(""GPQFXR""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓股票失败"", e);
        }
    }"
"    public static String getGptpgpSql(String tableSubfix, String tpgp) {
        StringBuilder sbSql = new StringBuilder();
        //股票信息
        sbSql.append("" gpxx"").append(tableSubfix).append("" as ( "");
        sbSql.append("" select GPMKET as MKET, GPCODE as ZQDM from tgcore.MONGP where GPDATE=? and GPTPGP='"").append(tpgp).append(""' "");
        sbSql.append("" ), "");
        //估值表股票信息
        sbSql.append("" gzgp"").append(tableSubfix).append("" as ( "");
        sbSql.append("" select KMZQLS,SECTYPE3,KMMKET GZMKET,GZZHDM,GZZQDM,GZSZZE,GZGZSL,GZZHMC "" +
                ""from tgcore.EVLGZ,TGCORE.MONKM where GZKMDM=KMCODE and GZCPDM=? and GZDATE=? and KMCPLX=? and KMTYPE='CB' and KMZQLX='GP' ""
                + ""and KMZQLS<>'KTTD' and ISFINAL='Y'"");
        sbSql.append("" ), "");
        //非公开发行股票
        sbSql.append("" fgkgp"").append(tableSubfix).append("" as ( "");
        sbSql.append("" select GZZHDM as ZHDM,GZZQDM as ZQDM,GZSZZE as SZ,GZGZSL as SL,GZMKET,GZZHMC from gzgp"").append(tableSubfix).append("" "");
        sbSql.append("" where KMZQLS in ('DXZF','LTSX') "");
        sbSql.append("" ), "");
        //新股
        sbSql.append("" xg"").append(tableSubfix).append("" as ( "");
        sbSql.append("" select GZZHDM as ZHDM,GZZQDM as ZQDM,GZMKET,GZZHMC from gzgp"").append(tableSubfix).append("" "");
        sbSql.append("" where KMZQLS = 'XG' "");
        sbSql.append("" ), "");
        //流通受限的转融通
        sbSql.append("" refin"").append(tableSubfix).append("" as ( "");
        sbSql.append(""     select GZZHDM as ZHDM,GZZQDM as ZQDM,GZSZZE as SZ,GZGZSL as SL,GZMKET,GZZHMC from gzgp"").append(tableSubfix);
        sbSql.append(""     where KMZQLS='ZRT' and SECTYPE3='LTSX'),"");
        //停牌股票
        sbSql.append("" tpgp"").append(tableSubfix).append("" as ( "");
        sbSql.append("" select GZZHDM as ZHDM, GZZQDM as ZQDM,GZSZZE as SZ,GZGZSL as SL,GZMKET,GZZHMC from gzgp"").append(tableSubfix).append("" "");
        sbSql.append("" where not exists (select 1 from fgkgp"").append(tableSubfix).append("" where GZZHDM=ZHDM) "");
        sbSql.append("" and not exists (select 1 from xg"").append(tableSubfix).append("" where GZZHDM=ZHDM) "");
        //除去流通受限的转融通
        sbSql.append("" and not exists (select 1 from refin"").append(tableSubfix).append("" where GZZHDM=ZHDM) "");
        sbSql.append("" and exists (select 1 from gpxx"").append(tableSubfix).append("" where GZMKET=MKET and GZZQDM=ZQDM) "");
        sbSql.append("" ) "");

        return sbSql.toString();
    }"
"    public List<FundEntity> getHoldStock(String prdCode, Date busDate, String subjectPrdType) throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        sbSql.append("" WITH kmgz AS ( "");
        sbSql.append("" select DISTINCT KMMKET AS GZMKET, GZZQDM, GZDATE from TGCORE.EVLGZ,TGCORE.MONKM "");
        sbSql.append("" where GZCPDM=? and GZDATE=? and KMCPLX=? and KMCODE=GZKMDM and KMZQLX = 'JJ' and ISFINAL='Y' and KMTYPE='CB' and KMZQLS<>'FZ' "");
        sbSql.append("" ), "");
        sbSql.append("" chjj AS ( "");
        sbSql.append("" select JJDATE, JJMKET, JJCODE, JJNAME, JJGLRN, JJTYPE, JJJL "");
        sbSql.append("" from TGCORE.MONJJ WHERE JJDATE = ? "");
        sbSql.append("" ) "");
        sbSql.append("" SELECT JJDATE, JJMKET, JJCODE, JJNAME, JJGLRN,JJTYPE, JJJL FROM chjj,kmgz "");
        sbSql.append("" WHERE chjj.JJDATE = kmgz.GZDATE AND chjj.JJMKET = kmgz.GZMKET AND chjj.JJCODE = kmgz.GZZQDM "");
        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), new Object[]{prdCode, busDate, subjectPrdType, busDate}, new RowMapper<FundEntity>() {
                @Override
                public FundEntity mapRow(ResultSet rs, int rowNum) throws Exception {
                    FundEntity res = new FundEntity();
                    res.setJjdate(rs.getDate(""JJDATE""));
                    res.setJjmket(rs.getString(""JJMKET""));
                    res.setJjcode(rs.getString(""JJCODE""));
                    res.setJjname(rs.getString(""JJNAME""));
                    res.setJjglrn(rs.getString(""JJGLRN""));
                    res.setJjtype(rs.getString(""JJTYPE""));
                    res.setJjjl(rs.getString(""JJJL""));
                    return res;
                }
            });
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓证券失败"", e);
        }
    }"
"    public List<Map<String, Object>> listholdstockinzyyxjxt(String prdCode, Date busDate, String subjectPrdType)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sbSql = new StringBuilder();
        sbSql.append("" WITH kmgz AS ( "");
        sbSql.append("" select DISTINCT KMMKET AS GZMKET, GZZQDM, GZDATE from TGCORE.EVLGZ,TGCORE.MONKM "");
        sbSql.append("" where GZCPDM = ? AND  GZDATE = ? and KMCPLX=? "");
        sbSql.append("" and KMCODE=GZKMDM and KMZQLX = 'GP' and ISFINAL='Y' and KMTYPE='CB' and KMZQLS<>'FZ' ), "");
        sbSql.append("" ccgp as( "");
        sbSql.append("" SELECT GPDATE, GPMKET, GPCODE, GPNAME FROM TGCORE.MONGP,kmgz  "");
        sbSql.append("" WHERE GPDATE = kmgz.GZDATE AND GPMKET = kmgz.GZMKET AND GPCODE = kmgz.GZZQDM ), "");
        sbSql.append("" zyyx as( "");
        sbSql.append("" SELECT GPCODE,GPMKET,GPNAME,TRADEDATE from TGCORE.MON_ZYYXJXT  "");
        sbSql.append("" where BUSDATE = ? and SECUTYPE = 'A股' ) "");
        sbSql.append("" SELECT ccgp.GPDATE, ccgp.GPMKET, ccgp.GPCODE, ccgp.GPNAME,zyyx.TRADEDATE "");
        sbSql.append("" FROM ccgp  "");
        sbSql.append("" LEFT JOIN TGCORE.MON_ZYYXJXT zyyx"");
        sbSql.append("" ON ccgp.GPDATE = zyyx.BUSDATE AND ccgp.GPCODE = zyyx.GPCODE AND ccgp.GPMKET = zyyx.GPMKET AND zyyx.SECUTYPE = 'A股' "");
        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        try {
            return jdbc.queryForList(sbSql.toString(), prdCode, busDate, subjectPrdType, busDate);
        } catch (Exception e) {
            throw new MonitorSystException(""获取持仓的股票信息失败"", e);
        }
    }"
"    public static String getGzbAndKmInfoOfProductPlayer() {
        StringBuilder sb = new StringBuilder(256);
        return sb.append(""SELECT  GZZQDM ,KMMKET ,sum(gzszze) AS gzszze,sum(gzcbze) AS gzcbze ,""
                + ""sum(gzgzsl) AS gzgzsl , sum(gzszbl) AS gzszbl ,sum(gzcbbl) AS gzcbbl from ""
                + ""( select distinct GZZHDM,GZZQDM,gzszze,gzcbze,gzgzsl,gzcbbl,gzszbl,KMMKET,KMCPLX,GZKMDM ""
                + "" from TGCORE.EVLGZ,TGCORE.MONKM""
                + "" where GZCPDM=? ""
                + ""  and GZDATE=? ""
                + ""  and "").append(getEvlgzAndKmJoinCondition()).append("" ) GROUP BY GZZQDM ,kmmket "").toString();
    }"
"    public void addHqck(String prdCode, Date gzDate) {
        sql.append("" select '"");
        sql.append(prdCode);
        sql.append(""' as CPDM, GZSZZE as JE, 0 as SYQX,'EVLGZ' as SJLY from TGCORE.EVLGZ "");
        sql.append("" where GZCPDM= ? and GZDATE=? and GZZHDM = '100201' "");

        args.add(prdCode);
        args.add(gzDate);
    }"
"    public void addBond(String prdCode, Date gzDate, Date chDate, Date endDate) {
        sql.append("" select '"");
        sql.append(prdCode);
        sql.append(""' as CPDM, JE,NVL(SYQX,0) SYQX,'MONZQ' as SJLY,GZZQDM as ZQDM,GZMKET as MKET,ZQCODE as MZQDM,JB,ZQZQLB as ZQLB from ( "");
        sql.append("" select (case substr(GZZHDM,5,1) when '1' then 'H' "");
        sql.append("" when '3' then 'S' else 'Y' end) as GZMKET,GZZQDM,GZSZZE JE "");
        sql.append("" from TGCORE.EVLGZ where GZCPDM=? and GZDATE=? "");
        sql.append("" and (GZZHDM like '1103__01_%' or GZZHDM like  '1104__01_%') and GZZQDM<>' ' "");
        sql.append("" )  GZZQ "");
        sql.append("" left join ( "");
        sql.append("" select ZQZQLB,ZQCODE,ZQMKET, "");
        sql.append("" case ZQZQLB when 'YP' then ZQENDD + INTERVAL '1' DAY when 'TYDC' then ZQENDD + INTERVAL '1' DAY "");
        sql.append("" else "");
        sql.append(""    case when ZQQLTK like '%C%' and ZQLLTZ <> '1900-01-01' "");
        sql.append(""       then ZQLLTZ "");
        sql.append(""       else   ZQSYQX  + TO_DATE('"" + chDate.toString() + ""'),'yyyy-mm-dd')  "");
        sql.append(""    end "");
        sql.append("" end as JZR, "");
        sql.append("" case ZQZQLB when 'YP' then ZQENDD-to_date('"" + chDate + ""','yyyy-mm-dd') +1 when 'TYDC' then ZQENDD-to_date('"" + chDate + ""','yyyy-mm-dd') +1 else "");
        sql.append(""    case when ZQQLTK like '%C%' and ZQLLTZ <> '1900-01-01' "");
        sql.append(""       then ZQLLTZ-to_date('"" + chDate + ""','yyyy-mm-dd') "");
        sql.append(""       else ZQSYQX "");
        sql.append(""    end "");
        sql.append("" end as SYQX, "");
        sql.append("" case ZQZQLB when 'ZCZQ' then NVL(ZQPJJB,' ') else NVL(ZQPJSD,' ') end as JB "");
        sql.append("" from tgcore.MONZQ where ZQDATE=? and ZQSYFW='P' and ZQSTAT='A' "");
        sql.append("" )  MZQ "");
        sql.append("" on GZMKET=ZQMKET and GZZQDM=ZQCODE "");
        sql.append("" where JZR <= ? and (ZQZQLB in ('YP','TYDC','GZ','DFZ','ZCJR') or (ZQZQLB not in ('KZZ', 'JHGS') and JB in ('AAA','AAA+'))) or ZQCODE is null "");

        args.add(prdCode);
        args.add(gzDate);
        args.add(chDate);
        args.add(endDate);
    }"
"    private void addZj(String prdCode, PrdEntity prd, Date evlDate) {
        sql.append(""select GZCPDM as cpdm, CAST('ZJ' as varchar2(4)) as TYPE, GZZHDM as CODE, ' ' as MARKET, sum(GZCBZE) JE, cast(0 as NUMBER) as SYTS from TGCORE.EVLGZ,TGCORE.MONKM "");
        sql.append(""where GZCPDM=? and GZDATE=? and GZZHDM=KMCODE and KMCPLX = ? AND ((KMZQLX IN ('BFJ','BZJ') AND KMZCLEVL = '1') OR (KMZQLX = 'CK' AND KMZQLS = 'HQ' AND KMTYPE = 'CB' and ISFINAL = 'Y')) "");
        sql.append(""group by GZZHDM,GZCPDM "");
        args.add(prdCode);
        args.add(evlDate);
        args.add(subjectConfig.getSubjectType(prd, evlDate));
    }"
"    private void addQsk(String prdCode, PrdEntity prd, Date evlDate) {
        sql.append(""select GZCPDM as CPDM, CAST('QSK' as varchar2(4)) as TYPE, GZZHDM as CODE,' ' as MARKET, sum(GZCBZE) JE, cast(1 as NUMBER) as SYTS  from TGCORE.EVLGZ,TGCORE.MONKM "");
        sql.append(""where GZCPDM=? and GZDATE=? and GZZHDM=KMCODE and KMCPLX = ? AND KMZQLX = 'QSK' AND KMZCLEVL = '1' "");
        sql.append(""group by GZZHDM,GZCPDM "");
        args.add(prdCode);
        args.add(evlDate);
        args.add(subjectConfig.getSubjectType(prd, evlDate));
    }"
"    private void addZq(String prdCode, Date evlDate, Date chDate) {
        sql.append(""select GZCPDM as CPDM, CAST('ZQ' as varchar2(4)) as TYPE,GZZQDM as CODE,KMMKET as MARKET,JE, ZQSYQX as SYTS from  "");
        sql.append(""(select GZCPDM,KMMKET, GZZQDM, sum(GZCBZE) JE "");
        sql.append(""from TGCORE.EVLGZ,TGCORE.MONKM where GZCPDM=? and GZDATE=? "");
        sql.append(""and GZKMDM=KMCODE and KMCPLX='TY' and KMZQLX='ZQ' and KMTYPE='CB' and KMZQLS<>'FZ' "");
        sql.append(""group by KMMKET,GZZQDM,GZCPDM ) A inner join TGCORE.MONZQ  on ZQCODE=GZZQDM and ZQMKET=KMMKET  where ZQDATE=? and ZQSYFW='P'"");
        args.add(prdCode);
        args.add(evlDate);
        args.add(chDate);
    }"
"    public List<Map<String, Object>> gqCbsz(MonObject monObject, DateParam dateParam) throws MonitorBussException, MonitorSystException {
        String kmcplx = subjectConfig.getSubjectType(monObject.getPrdEntity(), dateParam.getMonDate());

        CalendarUtil calUtil = new CalendarUtil();
        String cpdm = monObject.getValue();
        Date monDate = dateParam.getMonDate();
        Date jyrdq = CalendarUtil.addJysDate(dateParam.getMonDate(), 5, """");
        Date yhjdq = CalendarUtil.addYhjDate(dateParam.getMonDate(), 5, """");
        StringBuilder sbSql = new StringBuilder(1024);
        //现金
        sbSql.append(""with XJ as (select sum(GZCBZE) CB, sum(GZSZZE) SZ "");
        sbSql.append(""from TGCORE.EVLGZ where GZCPDM=? and GZDATE=? and GZZHDM='100201'),"");

        //国债、央票、政策性金融债以及五个交易日内到期的债券
        sbSql.append(""CYZQ as (select  kmmket as gzmket "");
        sbSql.append("",GZZQDM,GZCBZE,GZSZZE from TGCORE.EVLGZ ,tgcore.monkm "");
        sbSql.append(""where GZCPDM=? and GZDATE=? and "");
        sbSql.append("" kmzqlx in ('ZQ','ZCZQ') and KMTYPE='CB' and ISFINAL='Y' and kmcplx = ? and kmcode=gzkmdm),"");
        sbSql.append(""GZYPJR as ( "");
        sbSql.append(""select sum(GZCBZE) CB,sum(GZSZZE) SZ from CYZQ join TGCORE.MONZQ  "");
        sbSql.append(""on ZQDATE=? and GZMKET=ZQMKET and GZZQDM=ZQCODE and ZQSYFW='P' "");
        sbSql.append(""and (ZQZQLB in ('GZ','YP','ZCJR') or (ZQZQLB not in ('GZ','YP','ZCJR') and ZQENDD>=?  and ((zqmket ='Y' and  ZQENDD<? ) or (zqmket!='Y'  and ZQENDD<? ) )))),"");

        //交易所回购     'FBDQ'质押回购到期 QSDATE为回购截止日，截止日小于五个交易日（包含），并且截止日应大于业务日期
        sbSql.append(""GZJYS as ( "");
        sbSql.append(""select sum(QSCJJE) CB,sum(QSCJJE) SZ from TGCORE.JYSQS where QSYWBZ ='FBDQ' and QSMMBZ='B' "");
        sbSql.append(""and QSCRTD <=?  and QSDATE>? and QSDATE <=? and QSCPDM=?), "");

        //银行间回购    HGENDD为截止日
        sbSql.append(""GZYHJ as "");
        sbSql.append(""(select sum(HGCJJE)+sum(HGFSXF)+sum(HGFGHF) CB,sum(HGCJJE)+sum(HGFSXF)+sum(HGFGHF) SZ from TGCORE.YHJHG where "");
        sbSql.append(""HGDATE <=? and HGENDD>? and HGENDD <=? and HGCPDM =? AND HGSTAT ='A' and HGHGFX='B' ), "");

        //定期存款
        sbSql.append(""DQ as( "");
        sbSql.append(""select DQDQJE,DQCJBH,DQCKYH from TGCORE.EVLDQ where DQCPDM =? AND DQSTRD<=? and DQENDD>? and DQENDD<=? and DQSTAT='A' ), "");
        sbSql.append(""TQDF AS ( "");
        sbSql.append(""SELECT * FROM ( "");
        sbSql.append("" SELECT DQSYBJ,TQCJBH,row_number() over (PARTITION BY TQCJBH order by TQDFRQ desc) rn FROM TGCORE.EVLTQ "");
        sbSql.append(""WHERE TQCPDM=? and TQDFRQ <= ? AND TQSTAT='A')tq WHERE tq.rn <=1 ), "");
        sbSql.append(""DQJE as(select sum(nvl(DQSYBJ, DQDQJE))CB from DQ left join TQDF on DQCJBH = TQCJBH) ,"");

        //交易所协议回购
        //先取出业务标识为到期未清算的逆回购的信息，然后根据成交编号找到对应的首期或者延期数据，然后用成交金额+利息作为金额
        sbSql.append(""hglq as "");
        sbSql.append("" (  select nvl(sum(qsqtje),0) as zyhgje  from tgcore.jysqtqs where  "");
        sbSql.append("" qscpdm = ? and qsywbz = 'ZQLQ' and qsmmbz = 'S' and  qscrtd <= ? and qsdate > ? and qsdate <=? and qsstat = 'A' "");
        sbSql.append("")"");


        //总和
        sbSql.append("" select '"").append(cpdm).append(""' GZCPDM, "");
        sbSql.append(""(nvl(XJ.CB,0)+ nvl(GZYPJR.CB,0)+nvl(GZJYS.CB,0)+nvl(GZYHJ.CB,0)+nvl(DQJE.CB,0) + nvl(zyhgje ,0)) GZCBZE, "");
        sbSql.append("" (nvl(XJ.SZ,0)+ nvl(GZYPJR.SZ,0)+nvl(GZJYS.SZ,0)+nvl(GZYHJ.SZ,0)+nvl(DQJE.CB,0) + nvl(zyhgje ,0) ) GZSZZE "");
        sbSql.append("" from XJ, GZYPJR,GZJYS,GZYHJ,DQJE ,hglq "");

        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();
        Object[] orgs = new Object[]{cpdm, monDate,                    //现金
                cpdm, monDate, kmcplx, monDate, monDate, yhjdq, jyrdq,           //国债、央票、政策性金融债以及五个交易日内到期的债券
                monDate, monDate, jyrdq, cpdm,                        // 交易所回购
                monDate, monDate, yhjdq, cpdm,                        //银行间回购
                cpdm, monDate, monDate, yhjdq, cpdm, monDate,//定期存款
                //交易所协议回购
                cpdm, monDate, monDate, jyrdq};

        try {
            return jdbc.queryForList(sbSql.toString(), orgs);
        } catch (Exception e) {
            throw new MonitorSystException(e.getMessage(), e);
        }
    }"
"    List<Map<String, Object>> query(MetricDefinition metric, MetricDefinition dependMetric, SqlArg sqlArgUtil,
                                    final DateParam dateParam, final MonObject monObject)
            throws MonitorBussException, MonitorSystException {
        StringBuilder sb = sqlArgUtil.getSql();
        sb.append("" select "").append(getOutput(metric)).append("" from "").append(sqlArgUtil.getTableName());


        String condition = getCondition(dependMetric, dateParam, monObject);

        if (!StringUtil.isNullOrEmpty(condition)) {
            sb.append("" where "").append(condition.replace(""''"", ""' '""));
        }
        if (!StringUtil.isNullOrEmpty(sqlArgUtil.getWhitListSql())) {
            if (!StringUtil.isNullOrEmpty(condition)) {
                sb.append("" and "");
            } else {
                sb.append("" where "");
            }
            sb.append(sqlArgUtil.getWhitListSql());
        }

        String sql = sb.toString();
        if (isPenetrate()) {
            sql = sql.replaceAll(""(?i)TGCORE.EVLGZ"", ""TGCORE.MON_EVALUATION_PENETRATE "");
        }
        if (sql.toUpperCase().contains(""TGCORE.MON_EVALUATION_PENETRATE "")) {
            sql = sql.replaceAll(""(?i)TGCORE.MON_EVALUATION_PENETRATE "",
                    ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", dateParam.getEvlDate()) + "" "");
        }
        JdbcTemplate jdbc = JdbcTemplate.getJdbcTemplate();

        List<Map<String, Object>> result;
        try {
            result = jdbc.queryForList(sql, sqlArgUtil.getArgs());
        } catch (Exception e) {
            throw new MonitorSystException(e.getMessage() + sql, e);
        }
        return result;
    }"
"    private String getTableName(boolean isUseEvaluation, final DateParam dateParam) {
        String tableName;
        if (isUseEvaluation) {
            tableName = ""TGCORE.EVALUATION"";
        } else if (isPenetrate()) {
            tableName = ShardingTableUtil.replaceTableName(""TGCORE.MON_EVALUATION_PENETRATE"", dateParam.getEvlDate());
        } else {
            tableName = ""TGCORE.EVLGZ"";
        }
        return tableName;
    }"
"    private void sql4EvlgzPrdUnion(List<SubjectEntryPo> subjectEntryList, MonObject monObject, StringBuilder sql) {
        sql.append(""with"").append("" jrgz as ("").append("" select "")
                .append(getProductValuationSql(""jr"", subjectEntryList, false))
                .append("" , ? as GZCPDM , gzdate from TGCORE.EVLGZ, TGCORE.MON_BAILOR_PRD_SUBJECT"" +
                        "" where GZDATE = ? and GZCPDM = PRD_CODE and BUSDATE = ? and BAILOR = '"" + monObject.getPrdUnion()
                        + ""' and MONOBJECT_TYPE = 'P' and MONOBJECT = ? group by gzdate "")
                .append("" union all "")
                .append(""select "")
                .append(getProductValuationSql(""jr"", subjectEntryList, true))
                .append("" , ? as GZCPDM, BIZDATE as gzdate from TGCORE.EVALUATION, TGCORE.MON_BAILOR_PRD_SUBJECT"" +
                        "" where BIZDATE = ? and PRDCODE = PRD_CODE and BUSDATE = ? and BAILOR = '"" + monObject.getPrdUnion()
                        + ""' and MONOBJECT_TYPE = 'P' and MONOBJECT = ? group by BIZDATE), "");
        sql.append("" srgz as ("").append("" select  "")
                .append(getProductValuationSql(""sr"", subjectEntryList, false))
                .append("" , ? as srcpdm from TGCORE.EVLGZ, TGCORE.MON_BAILOR_PRD_SUBJECT where GZDATE = ? and "" +
                        ""GZCPDM = PRD_CODE and BUSDATE = ? and BAILOR = '"" + monObject.getPrdUnion()
                        + ""' and MONOBJECT_TYPE = 'P' and MONOBJECT = ? group by gzdate "")
                .append(""union all "")
                .append(""select "")
                .append(getProductValuationSql(""sr"", subjectEntryList, true))
                .append("" , ? as srcpdm from TGCORE.EVALUATION, TGCORE.MON_BAILOR_PRD_SUBJECT where BIZDATE = ? and "" +
                        ""PRDCODE = PRD_CODE and BUSDATE = ? and BAILOR = '"" + monObject.getPrdUnion()
                        + ""' and MONOBJECT_TYPE = 'P' and MONOBJECT = ? group by BIZDATE), "");
    }"
