<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.your.package.MonFilterExprBackupMapper">

    <update id="backupOrUpdateFromSource">
        MERGE INTO TGCORE.MON_FILTER_EXPR_BACKUP target
        USING (
            SELECT * FROM TGCORE.MON_FILTER_EXPR
            <where>
                <if test="originId != null and originId != ''">
                    ORIGIN_ID = #{originId}
                </if>
            </where>
        ) source
        ON (
            target.SYSTEM_ID = source.SYSTEM_ID AND
            target.ORIGIN_ID = source.ORIGIN_ID AND
            target.ORIGIN_TYPE = source.ORIGIN_TYPE AND
            target.SUB_METRIC_ID = source.SUB_METRIC_ID
        )
        WHEN MATCHED THEN
            UPDATE SET
                target.EXPR = source.EXPR,
                target.EXPRDESPRITION = source.EXPRDESPRITION,
                target.CREATE_USER = source.CREATE_USER,
                target.UPDATE_USER = source.UPDATE_USER,
                target.CREATE_TIME = source.CREATE_TIME,
                target.UPDATE_TIME = source.UPDATE_TIME
        WHEN NOT MATCHED THEN
            INSERT (
                SYSTEM_ID, ORIGIN_TYPE, ORIGIN_ID, SUB_METRIC_ID, EXPR,
                EXPRDESPRITION, CREATE_USER, UPDATE_USER, CREATE_TIME, UPDATE_TIME
            ) VALUES (
                source.SYSTEM_ID, source.ORIGIN_TYPE, source.ORIGIN_ID, source.SUB_METRIC_ID, source.EXPR,
                source.EXPRDESPRITION, source.CREATE_USER, source.UPDATE_USER, source.CREATE_TIME, source.UPDATE_TIME
            )
    </update>

    <insert id="insertFromSource">
        INSERT INTO TGCORE.MON_FILTER_EXPR_BACKUP (
            SYSTEM_ID, ORIGIN_TYPE, ORIGIN_ID, SUB_METRIC_ID, EXPR,
            EXPRDESPRITION, CREATE_USER, UPDATE_USER, CREATE_TIME, UPDATE_TIME
        )
        SELECT
            source.SYSTEM_ID, source.ORIGIN_TYPE, source.ORIGIN_ID, source.SUB_METRIC_ID, source.EXPR,
            source.EXPRDESPRITION, source.CREATE_USER, source.UPDATE_USER, source.CREATE_TIME, source.UPDATE_TIME
        FROM (
            SELECT * FROM TGCORE.MON_FILTER_EXPR
            <where>
                <if test="originId != null and originId != ''">
                    ORIGIN_ID = #{originId}
                </if>
            </where>
        ) source
    </insert>

</mapper>